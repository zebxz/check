9:00
prof diff btw task and handler 
class34
anisble feb 14



FORKS, HOST KEY GEN, PASSWORDLESSLY, APT/YUM MODULE, ROOT PRIVILEDGES, IDEMPOTENCY, ABSENT, USER MODULE, ENCRYPTION , SUDO !!, SETUP MODULE, ANSIBLE PLAYBOOK, PLAYBK SYNTAX,
YAML BASICS, LIST, DICTIONARY, Ansible task execution, REMOTE DEVELOPMENT, CLONING THE ANSIBLE SERIES REPO, HOW TO WRITE PlAYBOOK, RUN PLAYBOOK, MODIFY PLAYBOOK, DISABLE
MODULE

!= , is not 

********* WE HV 2 DEFAULT MODULES : Command module and setup module

httpd is a package manager for yum (redhat) while apache or debiem is a package manager for apt (ubuntu) linux

****** 1:35:30   its actually a better way to install openssl on your local env bc once u destroy your instance, it means ull hv to always be reintalling it but if you hv it
on your local env and you want to encrypt anything youcan just open openssl, u can use it to encrypt anything and you can send a PW or a key to someone then if they hv openssl 
they can decrypt it, they can use decrypt and get whatever info your trying to send 

*********** 1:37:22 you used sudo !! , was that to recall the previous command , in all cases
yes i want to recall the last command but am adding sudo to it, these are linux command which u guy shud hv done when u did linux, when u look at the short cuts in linux

58:16   *******we created the user in the control node but we had to ssh into the remote node(home of ansible to see the encryted PW of the user we created in /etc/shadow  ?


what command do you use to find your present working dir?  
ANS : pwd
now if i ask you to find your pwd, i dnt expect you to write a script, to put that insid eof a script bc its a one line command, its a command that u can directly execute on ur CLI
BUT if you have a multiple/series of commands that you want to execute then you can put them in a script 
so thats what an adhoc command is and we do that bc its smt that we dnt execute often 
adhoc command is a one line command and its smt we dnt execute often but if we hv multiplr command that we always run all the time then 
it is best practice to put multiple commands in a sript and  its less prone to error and all the time you run the script, you are runing the same command so its less prone to
error if you execute it as a script as oppose to u typing 10 commands bk to bk on the cli, you are prone to make mistakes
so for one line you can run it directly on the cli but for multiple commands u put it in a script thats waht automation is about 


so for ansible we hv adhoc commands but if we hv multiple commands that we want to pass tru ansible then we can write a play bk 

anytime we want to create a file , we use the file module
referring to video3 class33 ************ 1:05


***********13:06         ................ STARTS

i hv my config files so ill 
trfrm init
tefrm validtae
terfrm apply
its now creating my instance   ( he probably destroyed evrything at the end of last class
just as we did the other time am goin to b able to ssh in to my insatnce which is my control node 
after sshing , i need to connect with ssh but i wnat to do it passwd less authentication so ill exchange a key
so this is the processwe already went tru and u shud be familiar with it now
you first provison ur instances and once evrytin has been installed , then we go ahead and create our ssh keys

output:
control server
ansible_publicip = 54.185.247.171
  instance private ip =[
"172.31.21.91"
"172.31.28.218"

 ********************** the host
inatance pub ip 
35.91.190.201
35.89.8.147

rhel private ip
172.31.21.92
public
50.112.62.228

18:30******* evryting has been created so we go into our host file 

so we first ssh into our that instance  (using the public ip): 54.185.247.171
after which we configure our host file
in aws click conncet, he copied the ssh command for the instance  54.185.247.171

19:23******* 
again am doing this still on my terminal (terfrm IDE) but hv already provisIoned dit in my vscode 
so i can stilluse my vscode to do it, and ill show you when we write playbks 

#### 1) 
but for now ill just ssh in 
splits his terminal
cd into downloads , where the key is , so that it finds the key
paste the command 
yes
now am in my instance 
so i caraeted a user called ansible
so ill 

####  2)
ubuntu@ip-172-31-28-203: $ sudo su - ansible 

now am in my ansible server
ansible@ip-172-31-28-203: $ ansible aa -m ping   ... .. said  he meant to type all but its seeing it that he wants to ping the group
provided host list is empty, only localhost is available 
ansible@ip-172-31-28-203: $ ansible localhost -m ping 
success
now i can cd and config my host file 

##### 3)
ansible@ip-172-31-28-203: $ vi /etc/ansible/host
and we see evrythin has been commanted 
so i need to now insert my host
i want to create 2grps just as we did it the other time    .......... 23:45
the grp could have 20 server, 50 servers
created db and web grp

so basically hes doing the same thing WE Already did in video2

#### 4)

to disable key host checking (we need to change to false)
ansible@ip-172-31-28-203: $  vi /etc/ansible.cfg
as we see evrytin is commented out , it is bc evrytin is ruuning by default , they are default setting, default just means ansible config is in the etc/ansible  bt if u want 
to see the actual file run this command and it will generate for you your actual file ansible-config init --disabled -t all > ansible.cfg
ansible@ip-172-31-28-203: $  ansible-conifg init --disabled -t all > ansible.cfg
am using this to redirect, its going to overide evrything in the config file so the config file wil now hv content

ansible@ip-172-31-28-203: $  vi /etc/ansible/ansible.cfg                       *but he didnt see the file so he ls
ansible@ip-172-31-28-203: $  ls
ansible.cfg                                          ****** ok it created it in my pwd 
ansible@ip-172-31-28-203: $  cat ansible.cfg
we see the configfile and most of the tins hv been commented

 
31:35 ****************************  FORKS 
we hv what is called forks
its like how many servers ansible can confiure ta once ie in parrarrel


INTERVIEW QUSETION
can you configur your ansible so that it execute task on remote host in series , ie one hsot after another

ANS:
yes you can do that by setting your forks number to 1 so that ist only executing task on one SERVER AT A TIME 

bt right now by default its set to 5, so its able to configure 5servers at the same time, basically in parrarrel 

#************* by deafault keyhost checking has been set to true but now we hv to change it to false
so vi 
ansible@ip-172-31-28-203: $  vi ansible.cfg
and cahnge true to false

SO HOST KEY CHANGEHAS BEEN configured , so we wont be asked if i want to connect 

##### 5)
next
ansible@ip-172-31-28-203: $  ssh-keygen
key generated

ansible@ip-172-31-28-203: $ ssh-copy-id 172.31.21.91
password :ansible 
key added
ansible@ip-172-31-28-203: $  ssh-copy 172.31.28.28.218
key added
ansible@ip-172-31-28-203: $ ssh-copy 172.21.92

so hv configured my remote hoste to be managed remotelessly
key 


38:21                  contd frm video2
**************** back to ansible modules

6) (Apt)  yum Module

Used to install a package in the ansible client.
$ ansible db -m apt -a "name=apache2 state=present" --become

$ ansible db -m service -a "name=apache2 state=started" --become

$ ansible db -m apt -a "name=nginx state=present" -b


                                              ROOT PRIVILEDGES   "-b"
41:05 ***** 

we need root priviledge to install a package  and  apt or yum will be used interchangeably  e.g yum for redhat and apt for ubuntu (debiem package manager) 
so we use a command called "become" to excalate our priviledges or a " -b " option , -b just means you wnat escalate the priviledges, w ewnt to use sudo prividege

ansible@ip-172-31-28-203: $ $ ansible all -m yum -a "name=apache2 state=present" --b
failled for the first ubuntu server
failed for the 2nd ubuntu server
also failed for the redhat server     *********** bc it couldnt find apache tool

*********  yes when we are working with yum module, apache tool is nt part of the yum repo, instead you need to install httpd 
httpd is the same package but its the package thats in the yum repository  bc were trying to install a package(apache) thats not part of yum repository
so bc of this now we hv to change our package 
but if i still want to install apache then apache is a package for the apt repository or dibiam 
$ ansible db -m apt -a "name=apache2 state=present" --become
   this package is apcahe
but if am using yum i need to insatll httpd
$ ansible db -m yum -a "name=httpd state=present" --become
   thats the package for yum 

  ansible@ip-172-31-28-203: $ $ ansible all -m apt -a "name=apache2 state=present" -b
chnage is true
  succes for the first ubuntu server
change is true
success for the 2nd ubuntu server
But  failed for the redhat server  

####### 6iI)                                   
45:29
*************  *****************             IDEM POTENCY

if i run the caommand again  :
  ansible@ip-172-31-28-203: $ $ ansible all -m apt -a "name=apache2 state=present" -b

chnage is false                              *********** this is because the package has already been installed & so, ansible will nt install it again
  succes for the first ubuntu server
change is false                                         ********* this is called idem potency
success for the 2nd ubuntu server
But  failed for the redhat server  

   INTERVIEW QUESTION
WHAT is idem potency 

ANS:
Anisble does not reinstall  a package thats already insatlled or run a task that has already been completed 


###  6iII)
***************************** ABSENT 
 to remove the package ill say state is absent 

  ansible@ip-172-31-28-203: $ $ ansible all -m aptm -a "name=apache2 state=absent" -b

chnage is true                            ***********   pacakge has been removed 
  succes for the first ubuntu server
change is true                                       
success for the 2nd ubuntu server
But  failed for the redhat server  


*********** so now we see we can use yum or apt to install our packages


#### 6iV)
48:07 ************
                                    USING YUM 
to use yum , instead of all , ii use the grp name : web       ( we can use either present or latest)

  ansible@ip-172-31-28-203: $ $ ansible web -m yum -a "name=httpd state=present" -b      **** so it will instal httpd on yum on that particular grp &it wilinstall the lastest
it will check my web grp whic is redhat                                                      nd am using -b bc we are installing a package, we nid sudo priviledges

change =true                                                                                         

******** we installed using a yum module

********* so we hv apache(or he said package) module, apt module, yum module 
all these are ansible modules that you can use , modules are small programm that we are using 
all thses are package managers
we are using package mangers to be able to install package in our servers

48:42
***********
we can use a service module if we need to start our appl
we can install ngnix and we can start it by using a service module

#### 
   7) Service Module

You can use the service module to manage services running on the remote nodes managed by Ansible. This will require extended system privileges, so make sure your remote user has sudo permissions and you include the --become option to use Ansible’s privilege escalation system. Using -K will prompt you to provide the sudo password for the connecting user.

$ ansible all -i inventory -m service -a "name=nginx state=restarted" --become -K

$ ansible all -m service -a "name=nginx state=stopped" --become -K

*********** lets install ngnix on our db group
installing ngnix using apt

  ansible@ip-172-31-28-203: $ $ ansible db -m apt -a "name=nginx state=present" -b
change = true          installed

now to start the service                 ************* we need sudo priviledge to start it  so "-b"  , its only admin who can start it
  ansible@ip-172-31-28-203: $ $ ansible db -m service -a "name=ngnix state=restarted" -b
change=true
state = started

53:20
on the other splited part of the terminal
terraform output
we see our output
he copied one of the public ip of the host and bc ngnix runs on port 80
35.91.190.201:80    in google
we see apache runing on that particualr ubuntu
so we hv used service module to start the service 
we can still use the service module to stop it 
  ********  
  ansible@ip-172-31-28-203: $ $ ansible db -m apt -a "name=nginx state=stopped" -b
now the service has been stopped

56:18

############ 8)

8) User Module
Used to create user accounts.  (TO create users, but you wil first craete an encrypted pW for the user)
Create a password encryption
Generate the password from your local environment
$ openssl passwd -crypt <desired_password>

$ ansible db -m user -a "name=Peter password=wiyiMQbLhCRUY shell=/bin/bash" -b

                                ENCRYPTION , SUDO !!
eg 
 ansible@ip-172-31-28-203: $ cat /etc/shadow
permission denied 
 ansible@ip-172-31-28-203: $ sudo !!
we see the list  of paswords
we see ansible pW was encrpted, so pW are stored as encrypted in /etc/shadow file

eg                         CREATING A uSER

 ansible@ip-172-31-28-203: $ openssl passwd -crypt mark
unknown                                                           ********** he said openssl isnt installed


************ he went to the other part of his terminal
(base) - terraform files openssl passwd -crypt mark                       ********* bc he has openssl insatlled here his local env, the other part is his ec2 instance
psv/alszgssq                                                       ***********i hv encrypted the PW n it has been genearated,this is the PW we need to pass as encrypted

*********** back on the other part of the terminal 
using the user module , i will craete the user in the db grp
 ansible@ip-172-31-28-203: $   ansible db -m user -a "name=mark" password=psv/alszgssq shell=/bin/bash" -b
change=true                         ********   it has created a user mark
home : "/home/mark"                        created a home 
 password :                            NOT LOGGING PASSWORD            ******* so u cant use d encryted PW a sa login PW, what u nid to use is d decrypted PW(mark)
its saved in the/ etc/paswd thats why its encrypted

1:03:19
to see the encrypted PW , we need to ssh into one of the instances (so we left the control node)
psv/alszgssq   
ansible@ip-172-31-28-203: $  ssh 172.31.21.91
welcme to ubnuntu                                       ******* now in the home of ansible 
ansible@ip-172.32.21.91 :$ cat /etc/passwd
mark : /home/bin/bash
ansible@ip-172.32.21.91 :$  cat etc shadow 
permission denied
ansible@ip-172.32.21.91 :$  sudo !!
mark: psv/alszgssq                         encrypted but to login as mark , ill pass the PW as mark cos mark is the PW that we encrypted,
                                                 but when using an ansible playbk to craete a user u hv to encrypt d PW using openssl and then pass it 



####                           
9)   Setup module
This is a default module and is used to gather facts about the hosts.  egused to go to the host to gather facts, to find out wheter python has been installed, to find out
what package manager this server uses..... this is also a default module

The setup module returns detailed information about the remote systems managed by Ansible, also known as system facts.

To obtain the system facts for group1, run:

$ ansible group1 -m setup

This will print a large amount of JSON data containing details about the remote server environment.

To print only the most relevant information, include the "gather_subset=min" argument as follows:

$ ansible group1 -m setup -a "gather_subset=min"

To print only specific items of the JSON, you can use the filter argument. This will accept a wildcard pattern used to match strings. For example, to obtain information about both the ipv4 and ipv6 network interfaces, you can use ipv as filter:

$ ansible group1 -m setup -a "filter=ipv"


#########a)

ansible@ip-172.32.21.91 :$  exit                    the ****** host instance/ansible home to go bk to the contorl node
ansible@ip-172.31.28.203 :$ ansible web -m setup                    ****** it will return info abt this redhat server
success
there are lots of info it returns , its called gathering fact

1:7:50
*********eg 
ansible architecture" x86_64
some of the facts returned are like variables that can be accessesed and we wil see hw to do that
if i wanted to,i can use a variable to find the architecture of my server, i can use it as a filter
therfor i can use my setup module and call these variables
ill say if ansible architecture"  is  x86_64 , i can pass condition like that 
then ansible will go out bc of the setup module, it will look for servers or host that has this architecture and those are the servers that its going to perform  a task on  

also i can look at 
ansible _distribution : redhat                   ******** and we will be using this variables
i can say that i want to configure instances whose ansible distribution is redhat
eg 
when i was running the command that we were installing httpd or apache, i would hv passed a variable and say install apache if ansible distribution is debiem bt install 
httpd if ansible distribution is erdhat 
so the satup module will go out and check all your servers then whatevr dustribution it returns if the distribution is redhat its goin to install httpd , if the distribution
is debiam it will install apache 
so thats hw u can use ansible with a setup module to automate process to dynamically hv it go an install packages based on the operating system, we wil see hw we can do that

*******there are lot of varaiables, key value pairs that you can reference based on what you want
you 

ansible os family, ansible pkg_mg , so you can use all these as variables to filter out what resource sor server you want to maintain or configure 


#########  b)
1:10:41              ***************


To print only the most relevant information, include the "gather_subset=min" argument as follows:

$ ansible group1 -m setup -a "gather_subset=min"


eg
ansible@ip-172.31.28.203: $ ansible web -m setup -a "gather_subset=min"
 so it wont print out evrytin , just the most inportant, like a summary of all the vraiables you  can use reference


******** we can disable this setup madule by passing  a flag called gather facts = false 
we will see hw to do that in playbks 


          INTERVIEW QUESTION
whan you  pass an option like :gather facts= to false what module are you disabling

ANS: 
You are diasbling the setup module



10)
###### Debug module
Executes only on the local host to display some information- message or variable value.

We do not need ssh connectivity or password for a debug module. When using the debug module, the arguments will either be
- msg = to display a message
- var = to display a variable

**Default variables**                             ******** these are some variables within ansible 
    - inventory_hostname
    - inventory_hostname_short
    - groups/ groups.keys()
$ ansible all -m debug -a "var='This is a debug module'"             ******** it wil perform d task on my ansible control node display the msg on my ansible control node 
$ ansible all -m debug -a "msg={{}}"                                 *** so am using a debug module for info so that i can get the info y bc if am printing smt like  a file
                                                                  or perfroming a task, its been performed on the remote host, bt if i want info i can use debug so that it
                                                              prints out info on my ansible control node and with that i can pass d arguments as either variable e.g 
inventory_hostname

You can use debug to display variables.
$ ansible all -m debug -a "var='inventory_hostname'"         ******* d eg, in quotation marks like this bc already this is a variable
$ ansible all -m debug -a "msg={{inventory_hostname}}"      **** bt i can pass d same tin using a msg argument bt it has to be in these brackets,bc its how we read variables

If you have an inventory with entries like 'server1.cloud.production.host' then the command below will return server1.
$ ansible all -m debug -a "msg={{inventory_hostname_short}}"

You can also use debug module to display groups or groups keys in your inventory.
$ ansible all -m debug -a "var='groups'"
$ ansible all -m debug -a "var='groups.keys()'"


###### a)
*********   1:15:26
eg
 inventory hostname of  db host group

ansible@ip-172.31.28.203: $   $ ansible db -m debug -a "var='inventory_hostname'"                  ***** am specifying this is a variable
success
ineventory hostname : 172.31.21.91                 ******* on my db the iventory hostname are theese two 
success
ineventory hostname : 172.31.28.218               ***** bc its a debug module ,it will return this info

but if i want info for ansible os family
ansible@ip-172.31.28.203: $  ansible db -m debug -a "var='ansible_os_family'"      *****  i want to find out for my db what are my os ansible fmaily 
success
varIble is nt defined 
 success
varIble is nt defined

ansible@ip-172.31.28.203: $    ansible db -m debug -a "var='ansible_distribution'"   
success
variable not defined
ansible@ip-172.31.28.203: $    ansible db -m debug -a "gather_subnet=min'"              ******* 1:18:13
we see a lot of variables like when we ran setup module

******* dnt knw why its saying vaiable not defined , well thats how u use  a variable  but if you are pasing it as a msg put it in bracket/calibras

ansible@ip-172.31.28.203: $   ansible db -m debug -a "msg={{inventory_hostname}}"      
success
msg: 172.31.21.91
succes 
msg:    172.31.28.203             ***** we see the key word msg ,the key is msg

*** so all these varaiables are been read using our debug module and its displaying info on our system, inventory hostanme is been displayed as a msg

so thats how we use debug module
as we go further we ll see hw we can this debug


### b)
********** 

TO KNOW THE GROUPS I HAVE 

$ ansible all -m debug -a "var='groups'"


###  c)
********* 
  to know the keys i have 
i can pass it as a msg or a variable 


ansible@ip-172.31.28.203: $ ansible db -m debug -a "msg='groups.keys()'"
  172.31.21.91 success
  msg: 
   all
ungrouped
   db
  web                                     **** so these are the grps that i hv in my invenory

172.31.28.218 success
  msg: 
   all
ungrouped
   db
  web     
                              so am using a degug to read my inventory and the variables that are defined inside of my inventory and these variables are been retuned as grp


********* these are some of the basic modules that w eneed to knw , bt again as we lookde, ANSIBLE has a ton of modules that are there, public modules taht are there that
you can use 



###### complaint
am trying to run the openssl its nt working, i copied the command diresctly frm the scripte

ANS
OK dnt copy, type it bc atimes the operator may see it as smt different

i typed it the same thing
ok , tyr it on your gitbash, bc the most imp thing iS that you just want to encrypt the PW 


   QUESTION
1) when u did the ssg ken gen, you configured for 3servers, what if you want to do it for 50 servers , is that what you will do for all 50?
also when you created a user you first created a PW, but to do it for 50 users, is ther a way to do it in bulk

ANS:
you can hv a script that can loop tru your invnetory , bt ryt now we v been do in it maunally bc we nid to understand the concept, bt as we go further Tomao we wil look at 
dynamic inventories if i hv 50servers ders no way ill go into the 50 serevers to get the inventories, the i[p addresses  so i can configure it, with dynamic invnetory, i 
dnt need to configure my host file, instaed ill use a script taht wil go into aws , even if its 100servers, based on the script am using it goes and and get all the servers
ips and return it as an inventories then ansible will just use that as an inventory to go and do your configuration

but what ull do here, esp in your prod env goin forward, most companies wil use what is called custom AMIs, ie an AMI that hv created bc am using it for a coy, this AMI will
be managed by ansible b4 i craete the AMAI, i already exchange the key i pass in the key, the ssh key, you load it with all the software b4 you craete an instance for it
so when i introduce ansible to mg8 it i dnt nid to worry abt ssh keys anymore bc this custome AMI alraedy has a user called ansible baked in, a pecific key has already been 
exchanged so my ansible usser is already set so ill create ec2 instances based on this AMi, i can spin up a 100 instances based on this AMi.when i use that AMI , it will 
already hv been configured to be maintained by ansible but if i just hv insatnces that exists in aws then we ll see hw i can use dynamic inventory script that wil go into aws 
search tru d region, get all d inastnces and return that as an inventory then ansible wil use the ip addreses and go out and just do configuration.

*** 1:43:20
then for users, u can use loops , loop tru instances, if i hv maultiple packages that i need to install, i can use like foreloops that will loop tru all the variables that i 
hv, it will loop tru all the packages and one by one & those wil be installed & the same thing again for users,we can set a foreloop so that it  loops tru all our inventories
and for each server its configuring a user

as we go tru play bks and roles then things will start to mk more sense bt now we are focusing on the conept and the basics of hw actually things works


***********1:46:08

11)   
  ###  
                                               ANSIBLE PLAYBOOKS (are written in YAML) task run frm top to bottom

   ie, hv captured it as a code so am able to reuse it , this an eg of having infrasture,conifguration as a code,i hv my playbk wher i hv my configuration n i can reuse it
so if you need to execute a task with ansible more than once then write a playbk bt if its just one task you can use an ahod command 

***********  Ansible Playbooks offer a repeatable, re-usable,simple configuration management and multi-machine deployment system,one that is well suited to deploying 
complex applications.

If you need to execute a task with Ansible more than once, write a playbook and put it under source control. Then you can use the playbook to push out new configuration or 
confirm the configuration of remote systems.

Playbooks can:
declare configurations
orchestrate steps of any manual ordered process, on multiple sets of machines, in a defined order
launch tasks synchronously or asynchronously
Playbooks record and execute Ansible’s configuration, deployment, and orchestration functions.

They can describe a policy you want your remote systems to enforce, or a set of steps in a general IT process.
If Ansible modules are the tools in your workshop, playbooks are your instruction manuals,(ie playbk gives ansible the instruction on what to do) and your inventory of hosts
are your raw material.  (ie these instructions always happens on your inventory, on the host that u hv defined )

At a basic level, playbooks can be used to manage configurations of and deployments to remote machines. At a more advanced level, they can sequence multi-tier rollouts 
involving rolling updates, and can delegate actions to other hosts, interacting with monitoring servers and load balancers along the way.

Playbooks are designed to be human-readable and are developed in a basic text language. There are multiple ways to organize playbooks and the files they include.


###
11a)
  Playbook syntax

Playbooks are expressed in YAML format with a minimum of syntax.
A playbook is composed of one or more ‘plays’ in an ordered list.
The terms ‘playbook’ and ‘play’ are sports analogies. Each play executes part of the overall goal of the playbook, running one or more tasks. Each task calls an Ansible
module.
A playbook runs in order from top to bottom. Within each play, tasks also run in order from top to bottom.
Playbooks with multiple ‘plays’ can orchestrate multi-machine deployments, running one play on your webservers, then another play on your database servers, then a third play
on your network infrastructure, and so on. (ie if u hv multiple play u can hv dif target, one play targeting db instances, the other web instances bc each play wil hv diff
arguments, it will v a host and it will hv task   *********** 1:53:20

At a minimum, each play defines two things:
the managed nodes to target, using a pattern
at least one task to execute (and this task wil hv  a module, ie what are you trying to do in this particular node) 


ie, so a playbk can hv multiple play, evry play wil hv some task, task will use a module, each task calls a module, task belongs to a play, a play belongs to a playbk, so i
can hv a playbk with 5plays then this diff plays are executing task on diff host bt those task each of them wil be calling  a module 

                                      INTERVIEW QUESTION
1) What programming lang can you write???
   
ANS:     YAML
when you writing playbk, its written in yaml so ull hv an experience writing YAML language

 2) whats the diffERNECES btw ansible and terfrm 
ANS:

ansible wil run frm top to bottom, that concept we say that ansible is procedural , it follows a certain procedure ,frm top to bottom so you hv to order the task 
so when a task fails ansible will stop, if it encounters smt that fails your play will stop and it will stop right der bc it runs frm top to bottom

whereas
terrafrm is declarative, is nt procedural, it doesnt matter hw the files are organized, doesnt matter hw u put the mainfest files in a dir, bc ist declarative, it will read
everytin firt then create  a plan , so it doesn tmatter the order of the files 
thats one of the key differences when it comes to our automation tools


1:53:52

####
11b)
  Ansible task execution

By default, Ansible executes each task in order, one at a time, against all machines matched by the host pattern.

Each task executes a module with specific arguments. When a task has executed on all target machines, Ansible moves on to the next task.

When you run a playbook, Ansible returns information about connections,the name lines of all your plays and tasks, whether each task has succeeded or failed on each machine,
and whether each task has made a change on each machine.

At the bottom of the playbook execution, Ansible provides a summary of the nodes that were targeted and how they performed.

General failures and fatal “unreachable” communication attempts are kept separate in the counts.

Desired state and ‘idempotency’
                                         eg, i wnated to install httpd or apsche, once hv installed it bc i ran a command then that was my desired state
Most Ansible modules check whether the desired final state has already been achieved, and exit without performing any actions if that state has been achieved, so that 
repeating the task does not change the final state.

Modules that behave this way are often called ‘idempotent.’ Whether you run a playbook once, or multiple times, the outcome should be the same.


11c)
#####

Yaml basics

For Ansible, nearly every YAML file starts with a list.
Each item in the list is a list of key/value pairs, commonly called a “hash” or a “dictionary”.
So, we need to know how to write lists and dictionaries in YAML.
All YAML files can optionally begin with --- and end with ... . This is part of the YAML format and indicates the start and end of a document.
All members of a list are lines beginning at the same indentation level starting with a "- " (a dash and a space):


example:
         a list always has "-"
 ---
# A list of tasty fruits - Apple
  - Orange
  - Strawberry
  - Mango
...


11d)
#######

A dictionary is represented in a simple key: value form (the colon must be followed by a space):
# An employee record martin:
  name: Martin D'vloper 
  job: Developer
  skill: Elite



  ***  

Sample playbook

---
 - name: sonarqube playbook
   hosts: sonarqube                             ********* need to define who the host are 
   become: yes                              **** we ll see why am putting it there, become is yes, just like when we are passing it on a command line we said we pass a CLI flag 
   tasks:
 - name: install java
   yum:
   name: java-1.8.0-openjdk-devel.x86_64 state: present
 - name: create /opt/sonarqube directory file:
   path: /opt/sonarqube state: directory
 - name: Download and Unarchive/ unzip Sonarqube ansible.builtin.unarchive:
   src: https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-7.8.zip dest: /opt/sonarqube
   remote_src: yes
 - name: move sonarqube-7.8
   command: rm -rf sonarqube-7.8.zip && mv sonarqube-7.8 sonarqube
 - name: Add a sonar user shell: useradd sonar
 - name: Give sudo rights to sonar user
   shell: echo "sonar ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers.d/sonar
 - name: Recursively change ownership and permission of a directory file:
   dest: /opt/sonarqube/ owner: sonar
   group: sonar mode: 0775 recurse: yes
 - name: start sonarqube
   shell: sh /opt/sonarqube/sonarqube-7.8/bin/linux-x86-64/sonar.sh start become: yes
   become_user: sonar


##12)

2:00:28                                                REMOTE DEVELOPMENT
****************** 
TO STARt writing our playbk lets go to our vscode

  so this is my vscode that i have configured,my configured file  already has my ansible host name and my key
so i want to do what is called remote development
so bc it has already been configured like this , now again you dnt have to use that automation that we did
******** 2:00:05
all you hv to do is copy, go into your configure file and just add this  :
host ansible                                         2:03:29******* this is what will be used for ssh configuration
   HostName: 54:185:247:171
   user:    ansible
   identifyfile: ~?downloads/elks-instance.pem

 ull need to run this script in the link below, once you login in, you will need to follow this procedure here bc if u do jst the config above, ansible wil nt own the home
the home will stilll be owned by root, so you can ssh into your ansible control machine
https://github.com/LandmakTechnology/Ansible-mc-series/blob/main/02-Configuring%20managed%20nodes/remote-config.md

2:03:00
***** anisble has to own the authorized keys:      $ sudo chown ansible:ansible authorized_keys
also the /etc/ansible , if it deosnt , ansible wont hv right to write to this dir 
 $ sudo chown -R ansible:ansible /etc/ansible

**** you can fo;;ow the script if the automated way isnt working for you bt if its working then its easier bc its just configuring that 

####
12a)

2:04:00
********* so now in my vscode , click connect to host which is ansible
are you sure you want to continue :yes
i can open , and am opening it in the home of ansible dir  /home/ansible/
am now in the home of ansible
i hv my ansible config file that i created
now in the home of ansible, i can create a dir, call it ansible
if i open a new terminal, ill see i hv a dir called ansible

ansible@ip-172-31-28-203: ls
ansible ansible.cfg
ansible@ip-172-31-28-203: cd ansible
ansible@ip-172-31-28-203: git clone https://github.com/LandmakTechnology/Ansible-mc-series.git

##
12b)

cloning my entire ansible series      ***** watch 2:07:00
now if i go to my ansible dir illl see that i hv all these one of whcih is my dir called palybooks
so inside of the playbks, i can open my simple playbooks and i can see my first play , 
if i open it,it will open for me right here and am able to do my editing right here
 we can cd into our directories and run our plays from here
but b4 we do that lets learn how to write a simple playbk

2:08:20
***** he said Emeka made some changes on that , can yous end that script to everyone for those using windows, Emeka made modification on the script it is going work for you..

##
12c)

2:08:50                
**********
ill create anoda dir inside of this dir, ill call it testing
it wasnt working on th up part of the vscode 
HE Just deccide to do it on the vscode terminal
ansible@ip-172-31-28-203: cd 
ansible@ip-172-31-28-203: mkdir testing
ansible@ip-172-31-28-203: cd testing       
ansible@ip-172-31-28-203:~/testings

he left the twminal and went on bk on the up part of the vscode  and created:  testing.yaml                ********** now craete this file/playbk inside of the testing dir 
we are writing a yaml file so the extension has to be YAML

now we are in the yaml file 

###
13)
                   **** 2:11:00     this is hw to write a playbook                ***** ******* (watch, although i wrote evryin out)
https://github.com/LandmakTechnology/Ansible-mc-series/blob/main/05-Playbooks/playbook.md

if  i have an adhoc command like this  :ansible db -m apt -a "name=apache2 state=present" -b
we are installling apache
i can rewrite this command into a playbk

first start with 3 , ---

  ---
 - hosts: db                                     ***** these are my host, in my hostfile i hv group called db
   tasks:                                         ******* bc i can put multiple task, its a list of task, i can pass alist of task
   - apt: name=apache2 state=present              *******  every task will hv a module , n for this task am using an apt module , apache2
     become: yes                                   *******  this play bc we knw we are installing a package we hv to use sudo , become=yes


so hv written a play without a name , hv jsut wirtten it like that, 


###
13a)

               To run ansible playbook
        ansible playbook-i inventory_file playbook.yaml

******** back to vscode terminal:

ansible@ip-172-31-28-203:~/testings ls
testing.yaml
ansible@ip-172-31-28-203:~/testings ansible-playbook test.yaml
******* when you look at this playbk, we are not passing any inventory, our default inventory is in the host, thas the default so bc we already hv a default, we dnt nid to
pass a -i option , bt if we hv a custom inventory then we ll pass a - i, to tell ansible we hv anoda inventory so dnt use the host file bt bc our inventory is in the host 
file and we hv a grp called db we ll nt specify -i, instaed we ll reference our playbk

ansible@ip-172-31-28-203:~/testings ansible-playbook test.yaml

PLAY db (gathering facts)
ok:172.31.28.218
ok:172.31.21.91

TASK (apt)
changed: 72.31.28.218
changed: 172.31.21.91



PLAY RECAP


######## 13b)

Explaining the result     .....  2:17:00

the play is jsut showing db, 
then we only passed just one task apt but in the result we hv 2task that ran
the 1st task is named as gathering facts, its your setup module
remember we said default module, your setup module will run to gather facts
it has gone to the inventory, it has found that the db grp ha sthese 2instances , these aour inventories
so it has gathered facts, it has found out facts abt these

then it has ran our task, this task is just called apt" bt this is nt the name , its just written apt 
then we see changed ie has has installed our apache

then it gives us a summary ie the RECAP

********* we had 2task but one is the default task, which was gathering facts 
so we see it was able to run

####
13C)
                                            MODIFYING THE PLAYBK
********  2:18:19
for this particular play, our playbk  here doesnt have a name but we can modify it so we give it a name

    ---
 - name: Install apache2            ******** name for our playbook
   hosts: db
   tasks:
   - name: apache2                       ********* name for our task
     apt:
        name: apache2
        state: absent
     become: yes                      **** become has to be on the same line as apt bc its nt a child of the module, its part of the module


******* this is the same playbook bt hv given a name to my task and playbook
bt bc this has alreday been installed, let me change, let me say state is absent and re run the play

ansible@ip-172-31-28-203:~/testings ansible-playbook test.yaml
so our playbk ran but apache was uninstalled bc the state is absent
and it ran from top to bottom

   
 2:24:14
######
13D)          
*******************       DISABLING MODULE


---
 - name: Install apache2
   hosts: db
   gather_facts: false              ***** thatis do not run the setup module
   tasks:
   - name: apache2
     apt:
        name: apache2
        state: present
     become: yes

******* run the ansible playbk again 

ansible@ip-172-31-28-203:~/testings ansible-playbook test.yaml

PLAY db (install apache)

TASK (apache2)
ok: 72.31.28.218
ok: 172.31.21.91


PLAY RECAP


***************  now  it just runs the play and then goes straight to the task which is apache
its skipping my gather facts
so this is hw you disable your setup module by passing gather fact to false

******* but as we will see later when it comes to automation u wnat to use the setup module bc if u diasble it u might nt be able to get acces to some sys variable that you 
may want to use for automation

######## ill just enable it back here to true


#### 13e)
*********** 2:23:55
lets say after installing this i want to use another module to start it , so i can add anoda task and i has to be n the same lavel/line with the previous task


   A service module can also be included to start apache with become on task level as follows;
---
 - name: Install apache2
   hosts: db
   tasks:
   - name: install apache2
     apt:
        name: apache2
        state: absent
     become: yes
   - name: start apache2
     service:
       name: apache2
       state: started
     become: yes


************ this playbk will fail  bc, state is absent, task start apache2 will fail bc , task apache2 is absent , bc its unable to start apache service
so for the task to succeed we need to change state to present then it will gather facts ,install apache then use a service module to start it, then d 3 tasks will be success
ansible@ip-172-31-28-203:~/testings ansible-playbook test.yaml


PLAY db (gathering facts)
ok:172.31.28.218
ok:172.31.21.91

TASK (apache2)
changed: 72.31.28.218
changed: 172.31.21.91

TASK (start apache2)
failed

PLAY RECAP
failed 


###                                using  become on a host
13f)

************** to reduce lines of code instead of passing become twice, on a task level (13e) thereby duplicating it , if all my task require sudo rights then i can pass it
on a host level 

You can use become on a host level as shown below;
---
 - name: Install apache2
   hosts: db
   become: yes                             ******** (can use true or yes)
   tasks:
   - name: install apache2
     apt:
        name: apache2
        state: present
   - name: start apache2
     service:
       name: apache2
       state: started

************ , bc its now at a host level, all tasks are running with sudo right, priviledge excalation bc become has been passed on a host level rather than having to pass
becomes for each the several tasks we hv


***** so this is how you can write a basic playbook


inside of our playbooks here ILL Just walk you through  (first play.yml)
******** 2:32:12

   - hosts: localhost                              ********* the host is just a localhost
   tasks:
   - debug:                                         ******** using a debug msg to display a msg
      msg: 'This is the day'
...

******* so inside this ansible dir, i have multiple playbooks to insatll like httpd on a web repo 
so ill cd 

ansible@ip-172-31-28-203:~/testings cd
ansible@ip-172-31-28-203:~/testings cd ansible/
ansible@ip-172-31-28-203:~/testings ls
Ansible-mc-series
ansible@ip-172-31-28-203:~/testings cd ansible-mc -series/o5-playbooks/01-simple-playbooks/
so i hv this httpd.yml which i want to insatll on my web which is my redhat, if i want to install on my redhat, then am insatlling httpd using yum
ansible@ip-172-31-28-203:~/testings ansible-playbook httpd.yml
now it will gather facst,
it will find a grp called web
it has installed it and started it cos am using the service to  start it 


2:34:25

Another file, again all these are just sample palybooks 
lets say i wnat change a line inside of a file

---
- name: selinux enable or disable
  hosts: db
  become: yes
  vars:                                  ******* am passing variables, hv defined as 
     status: permissive                          ******* my vars hv defined as status and this status am passing it as permissive
  tasks:
     - name: changing SELinux from config file
       lineinfile:       
           path: /etc/selinux/config                          ******* i hv a line inside the etc
           regexp: '^SELINUX='                         ********  this line selinux, we want to  change to permissive
           line: 'SELINUX={{ status }}'                ******* this is calibras is reading a varaible n the variable name is status bt the value is permissive
     - name: change directory                                           so it will replace the line selinux as permissive


*********  anothe file , uptime.yml
if i want to chaeck my uptime 

   ---
 - name: How to use debug module
   hosts: localhost
   tasks:
   - name: Memory info
     shell: df -h                               *********** i can run a shell script, am running this on my local host, i can run the shell to get d memory info then
     register: results                         i need to capture that info inside of a variable called results, am using the key word register meaning its goin to  
   - debug:                                 ******** i can use this debug module
      msg: "{{results}}"
      #var: "results"


i need to capture that info inside of a variable called results, am using the key word register meaning its goin to capture the info once it runs that bc if i run it as a
playbk its nt goin to display the info for me here bc the module wil just do the work and it just gives me a summary that everythin has been changed bt if i wan to see d 
result then i need to capture those result using what is called a register and am capturing it in a variable called result then i us ethe debug module to display that result

  ansible@ip-172-31-28-203:~/testings ansible-playbook uptime.yml
now i see the memory info  thats the task that ran 
TASK [memeory info]
changed [local host]

********* but if i  didnt use register it will just show that it changed, it did smt
so if i wantit displayed to me i need to capture it using a register, i need to reg in a variable and am using debug to display it bc its my local host so debug module will
display that register, the result that i captured in that task and now giving me what my memeory info is for my instance

****** so that is the uptime and httpd.yml 


   2:41:11

i can use conditions    , i have  another file install_httpd.yml

i want to install httpd or apache 
 ---
  - name: Simple play to install httpd or apache2
    hosts: all                                             ******** ie both db and web 
    gather_facts: false                                        ***** gather facts bc i need to read the ansible distribution
    become: yes          
    tasks:
    - name: Installing httpd using yum
      yum:
        name: httpd
        state: present                                                                                      when its nt ubuntu that means its redhat
      when: ansible_distribution != "Ubuntu"                        **** bt am passing a when, am saying install this when d ansible ditribution is nt ubuntu
    - name: Installing apache2 using apt
      apt:
        name: apache2
        state: present
      when: ansible_distribution == "Ubuntu"                      ********* install apache using apt when ansible distribution is ubuntu  


******* so am writing my playbk using a condition, am passing a condition that if my instance is ubuntu then i want to install apache using apt but if its nt ubuntu i want 
to install httpd

ill run it now with my setup as false 

  ansible@ip-172-31-28-203:~/testings cd../02-conditional\statements/
  ansible@ip-172-31-28-203:~/testings ansible-playbook install_httpd.yml
failed 

******* bc hv disabled gather facts its telling me the conditional check ansible distribution failed 
error while evaluating the distribution
ansible distribution is undefined

* so i hv an error bc the ansible distribution is undefined bc i hv disabled the setup module , ie gather facts

########## i change gather facts now to true or comment it out, ie its the default module that wil run to gather my facts

   ansible@ip-172-31-28-203:~/testings ansible-playbook install_httpd.yml


pLAY db (gathering facts)
ok:172.31.28.218
ok:172.31.21.91
ok: 172.31.21.92

TASK (installing httpd using yum)
skipping: 72.31.28.218
skipping: 172.31.21.91
changed: 172.31.21.92

TASK (installing apache2 using apt)
changed: 72.31.28.218
changed: 172.31.21.91
skipping: 172.31.21.92

PLAY RECAP



  ******* first task, to install httpd, it skipping bc it gathered facts on all 3servers bt found out that the 1st 2 are ubuntu , therfrore the task skipped it only 
installed on what is nt ubuntu which is redhat 

for the 2nd task, it did the reseverse


****** so i can see i can automate the process, i can use conditions, and am using conditions bc of the inbuilt variables which already exists, and am getting the variables 
using my setup module, am able to read the variables then made conditions based on the variables & am able to install packages just based on the distribution
this process has been automated

**** so this is how you can use conditions
and you can build in more logics so that ansible will use the logics you build in to mk decisions on wheter to install a package or not



  2:47:00  ************* /without_facts.yml

---
 - name: Finding os distribution and os name 
   hosts: all
   gather_facts: false
   tasks:
   - name: Finding os distribution
     shell: "cat /etc/os-release  | awk -F =  'NR==1 {print $2 }' | awk '{print $1}' | tr '\"' ' '"
     register: os_dist
   - name: Finding os name
     shell: "uname"
     register: os_name
   - debug:
      msg:
       - "The os distribution name is: {{os_dist.stdout}}"
       - "The os name: {{os_name.stdout}}"


eg
 i need to find the os distribution and os name of my host, then in that case ill need to run a shell script or shell command which will cat the etc/os release to find what
my os distribution is , ill need to find the uname, pass a shell script/command, then as i do that am registering the os distribution and when am running the uname am also
registering the os, then ill use the debug module to display that msg, d os distribution and also the os name 
so if hv disabled gather facts then ill need to run this shell command to be able to get my distribution and os


     ansible@ip-172-31-28-203:~/testings ansible-playbook without_facts.yml
 *** now i see  that its finding os distribution

PLAY [finding os distribution and os name]

TASK [finding os distribution]
changed:172.31.28.218
changed:172.31.21.91
changed: 172.31.21.92

TASK [finding os name]
changed: 72.31.28.218
changed: 172.31.21.91
changed: 172.31.21.92















