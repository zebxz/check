FORKS, HOST KEY GEN, PASSWORDLESSLY, APT/YUM MODULE, IDEM POTENCY, ABSENT


what command do you use to find your present working dir?  
ANS : pwd
now if i ask you to find your pwd, i dnt expect you to write a script, to put that insid eof a script bc its a one line command, its a command that u can directly execute on ur CLI
BUT if you have a multiple/series of commands that you want to execute then you can put them in a script 
so thats what an adhoc command is and we do that bc its smt that we dnt execute often 
adhoc command is a one line command and its smt we dnt execute often but if we hv multiplr command that we always run all the time then 
it is best practice to put multiple commands in a sript and  its less prone to error and all the time you run the script, you are runing the same command so its less prone to
error if you execute it as a script as oppose to u typing 10 commands bk to bk on the cli, you are prone to make mistakes
so for one line you can run it directly on the cli but for multiple commands u put it in a script thats waht automation is about 


so for ansible w ehv adhoc commands but if we hv multiple commands that we want to pass tru ansible then we can write a play bk 

anytime we want to create a file , we use the file module
referring to video3 class33 ************ 1:05


***********13:06         ................ STARTS

i hv my config files so ill 
trfrm init
tefrm validtae
terfrm apply
its now creating my instance   ( he probably destroyed evrything at the end of last class
just as we did the other time am goin to b able to ssh in to my insatnce which is my control node 
after sshing , i need to connect with ssh but i wnat to do it passwd less authentication so ill exchange a key
so this is the processwe already went tru and u shud be familiar with it now
you first provison ur instances and once evrytin has been installed , then we go ahead and create our ssh keys

output:
control server
ansible_publicip = 54.185.247.171
  instance private ip =[
"172.31.21.91"
"172.31.28.218"

 ********************** the host
inatance pub ip 
35.91.190.201
35.89.8.147

rhel private ip
172.31.21.92
public
50.112.62.228

18:30******* evryting has been created so we go into our host file 

so we first ssh into our that instance  (using the public ip): 54.185.247.171
after which we configure our host file
in aws click conncet, he copied the ssh command for the instance  54.185.247.171

19:23******* 
again am doing this still on my terminal (terfrm IDE) but hv already provisIoned dit in my vscode 
so i can stilluse my vscode to do it, and ill show you when we write playbks 

#### 1) 
but for now ill just ssh in 
splits his terminal
cd into downloads , where the key is , so that it finds the key
paste the command 
yes
now am in my instance 
so i caraeted a user called ansible
so ill 

####  2)
ubuntu@ip-172-31-28-203: $ sudo su - ansible 

now am in my ansible server
ansible@ip-172-31-28-203: $ ansible aa -m ping   ... .. said  he meant to type all but its seeing it that he wants to ping the group
provided host list is empty, only localhost is available 
ansible@ip-172-31-28-203: $ ansible localhost -m ping 
success
now i can cd and config my host file 

##### 3)
ansible@ip-172-31-28-203: $ vi /etc/ansible/host
and we see evrythin has been commanted 
so i need to now insert my host
i want to create 2grps just as we did it the other time    .......... 23:45
the grp could have 20 server, 50 servers

so basically hes doing the same thing WE Already did in video2

#### 4)

to disable key host checking (we need to change to false)
ansible@ip-172-31-28-203: $  vi /etc/ansible.cfg
as we see evrytin is commented out , it is bc evrytin is ruuning by default , they are default setting, default just means ansible config is in the etc/ansible  bt if u want 
to see the actual file run this command and it will generate for you your actual file ansible-config init --disabled -t all > ansible.cfg
ansible@ip-172-31-28-203: $  ansible-conifg init --disabled -t all > ansible.cfg
am using this to redirect, its going to overide evrything in the config file so the config file wil now hv content

ansible@ip-172-31-28-203: $  vi /etc/ansible/ansible.cfg                       *but he didnt see the file so he ls
ansible@ip-172-31-28-203: $  ls
ansible.cfg                                          ****** ok it created it in my pwd 
ansible@ip-172-31-28-203: $  cat ansible.cfg
we see the configfile and most of the tins hv been commented

 
31:35 ****************************  FORKS 
we hv what is called forks
its like how many servers ansible can confiure ta once ie in parrarrel


INTERVIEW QUSETION
can you configur your ansible so that it execute task on remote host in series , ie one hsot after another

ANS:
yes you can do that by setting your forks number to 1 so that ist only executing task on one SERVER AT A TIME 

bt right now by default its set to 5, so its able to configure 5servers at the same time, basically in parrarrel 

#************* by deafault keyhost checking has been set to true but now we hv to change it to false
so vi 
ansible@ip-172-31-28-203: $  vi ansible.cfg
and cahnge true to false

SO HOST KEY CHANGEHAS BEEN configured , so we wont be asked if i want to connect 

##### 5)
next
ansible@ip-172-31-28-203: $  ssh-keygen
key generated

ansible@ip-172-31-28-203: $ ssh-copy-id 172.31.21.91
password :ansible 
key added
ansible@ip-172-31-28-203: $  ssh-copy 172.31.28.28.218
key added
ansible@ip-172-31-28-203: $ ssh-copy 172.21.92

so hv configured my remote hoste to be managed remotelessly
key 


38:21                  contd frm video2
**************** back to ansible modules

6) (Apt)  yum Module

Used to install a package in the ansible client.
$ ansible db -m apt -a "name=apache2 state=present" --become

$ ansible db -m service -a "name=apache2 state=started" --become

$ ansible db -m apt -a "name=nginx state=present" -b


                                              ROOT PRIVILEDGES
41:05 ***** 

we need root priviledge to install a package  and  apt or yum will be used interchangeably  e.g yum for redhat and apt for ubuntu
so we use axommand called "become" to excalate our priviledges or a " -b " option , -b just means you wnat escalate the priviledges, w ewnt to use sudo prividege

ansible@ip-172-31-28-203: $ $ ansible all -m yum -a "name=apache2 state=present" --b
failled for the first ubuntu server
failed for the 2nd ubuntu server
also failed for the redhat server     *********** bc it couldnt find apache tool

*********  yes when we are working with yum module, apache tool is nt part of the yum repo, instead you need to install httpd 
httpd is the same package but its the package thats in the yum repository  bc were trying to install a package thats not  part of yum repository
so now we hv to change our package 
but if i still want to install apache then apache is a package for the pat repository or dibiam 
$ ansible db -m apt -a "name=apache2 state=present" --become
   this package is apcahe
but if am using yum i need to insatll httpd
$ ansible db -m yum -a "name=httpd state=present" --become
   thats the package for yum 

  ansible@ip-172-31-28-203: $ $ ansible all -m apt -a "name=apache2 state=present" -b
chnage is true
  succes for the first ubuntu server
change is true
success for the 2nd ubuntu server
But  failed for the redhat server  

####### 6iI)                                   
45:29
*************  *****************             IDEM POTENCY

if i run the caommand again  :
  ansible@ip-172-31-28-203: $ $ ansible all -m apt -a "name=apache2 state=present" -b

chnage is false                              *********** this is because the package has already been installed & so, ansible will nt install it again
  succes for the first ubuntu server
change is false                                         ********* this is called idem potency
success for the 2nd ubuntu server
But  failed for the redhat server  

   INTERVIEW QUESTION
WHAT is idem potency 

ANS:
Anisble does not reinstall  a package thats already insatlled or run a task that has already been completed 


###  6iII)
***************************** ABSENT 
 to remove the package ill say state is absent 

  ansible@ip-172-31-28-203: $ $ ansible all -m aptm -a "name=apache2 state=absent" -b

chnage is true                            ***********   pacakge has been removed 
  succes for the first ubuntu server
change is true                                       
success for the 2nd ubuntu server
But  failed for the redhat server  


*********** so now we see we can use yum or apt to install our packages


#### 6iV)
48:07 ************
                                    USING YUM 
to use yum , instead of all , ii use the grp name : web       ( we can use either present or latest)

  ansible@ip-172-31-28-203: $ $ ansible web -m aptm -a "name=httpd state=present" -b















