FORKS, HOST KEY GEN, PASSWORDLESSLY, APT/YUM MODULE, ROOT PRIVILEDGES, IDEM POTENCY, ABSENT, USER MODULE, ENCRYPTION , SUDO !!, SETUP MODULE 

********* WE HV 2 DEFAULT MODULES : Command module and setup module

58:16   *******we created the user in the control node but we had to ssh into the remote node(home of ansible to see the encryted PW of the user we created in /etc/shadow  ?


what command do you use to find your present working dir?  
ANS : pwd
now if i ask you to find your pwd, i dnt expect you to write a script, to put that insid eof a script bc its a one line command, its a command that u can directly execute on ur CLI
BUT if you have a multiple/series of commands that you want to execute then you can put them in a script 
so thats what an adhoc command is and we do that bc its smt that we dnt execute often 
adhoc command is a one line command and its smt we dnt execute often but if we hv multiplr command that we always run all the time then 
it is best practice to put multiple commands in a sript and  its less prone to error and all the time you run the script, you are runing the same command so its less prone to
error if you execute it as a script as oppose to u typing 10 commands bk to bk on the cli, you are prone to make mistakes
so for one line you can run it directly on the cli but for multiple commands u put it in a script thats waht automation is about 


so for ansible w ehv adhoc commands but if we hv multiple commands that we want to pass tru ansible then we can write a play bk 

anytime we want to create a file , we use the file module
referring to video3 class33 ************ 1:05


***********13:06         ................ STARTS

i hv my config files so ill 
trfrm init
tefrm validtae
terfrm apply
its now creating my instance   ( he probably destroyed evrything at the end of last class
just as we did the other time am goin to b able to ssh in to my insatnce which is my control node 
after sshing , i need to connect with ssh but i wnat to do it passwd less authentication so ill exchange a key
so this is the processwe already went tru and u shud be familiar with it now
you first provison ur instances and once evrytin has been installed , then we go ahead and create our ssh keys

output:
control server
ansible_publicip = 54.185.247.171
  instance private ip =[
"172.31.21.91"
"172.31.28.218"

 ********************** the host
inatance pub ip 
35.91.190.201
35.89.8.147

rhel private ip
172.31.21.92
public
50.112.62.228

18:30******* evryting has been created so we go into our host file 

so we first ssh into our that instance  (using the public ip): 54.185.247.171
after which we configure our host file
in aws click conncet, he copied the ssh command for the instance  54.185.247.171

19:23******* 
again am doing this still on my terminal (terfrm IDE) but hv already provisIoned dit in my vscode 
so i can stilluse my vscode to do it, and ill show you when we write playbks 

#### 1) 
but for now ill just ssh in 
splits his terminal
cd into downloads , where the key is , so that it finds the key
paste the command 
yes
now am in my instance 
so i caraeted a user called ansible
so ill 

####  2)
ubuntu@ip-172-31-28-203: $ sudo su - ansible 

now am in my ansible server
ansible@ip-172-31-28-203: $ ansible aa -m ping   ... .. said  he meant to type all but its seeing it that he wants to ping the group
provided host list is empty, only localhost is available 
ansible@ip-172-31-28-203: $ ansible localhost -m ping 
success
now i can cd and config my host file 

##### 3)
ansible@ip-172-31-28-203: $ vi /etc/ansible/host
and we see evrythin has been commanted 
so i need to now insert my host
i want to create 2grps just as we did it the other time    .......... 23:45
the grp could have 20 server, 50 servers
created db and web grp

so basically hes doing the same thing WE Already did in video2

#### 4)

to disable key host checking (we need to change to false)
ansible@ip-172-31-28-203: $  vi /etc/ansible.cfg
as we see evrytin is commented out , it is bc evrytin is ruuning by default , they are default setting, default just means ansible config is in the etc/ansible  bt if u want 
to see the actual file run this command and it will generate for you your actual file ansible-config init --disabled -t all > ansible.cfg
ansible@ip-172-31-28-203: $  ansible-conifg init --disabled -t all > ansible.cfg
am using this to redirect, its going to overide evrything in the config file so the config file wil now hv content

ansible@ip-172-31-28-203: $  vi /etc/ansible/ansible.cfg                       *but he didnt see the file so he ls
ansible@ip-172-31-28-203: $  ls
ansible.cfg                                          ****** ok it created it in my pwd 
ansible@ip-172-31-28-203: $  cat ansible.cfg
we see the configfile and most of the tins hv been commented

 
31:35 ****************************  FORKS 
we hv what is called forks
its like how many servers ansible can confiure ta once ie in parrarrel


INTERVIEW QUSETION
can you configur your ansible so that it execute task on remote host in series , ie one hsot after another

ANS:
yes you can do that by setting your forks number to 1 so that ist only executing task on one SERVER AT A TIME 

bt right now by default its set to 5, so its able to configure 5servers at the same time, basically in parrarrel 

#************* by deafault keyhost checking has been set to true but now we hv to change it to false
so vi 
ansible@ip-172-31-28-203: $  vi ansible.cfg
and cahnge true to false

SO HOST KEY CHANGEHAS BEEN configured , so we wont be asked if i want to connect 

##### 5)
next
ansible@ip-172-31-28-203: $  ssh-keygen
key generated

ansible@ip-172-31-28-203: $ ssh-copy-id 172.31.21.91
password :ansible 
key added
ansible@ip-172-31-28-203: $  ssh-copy 172.31.28.28.218
key added
ansible@ip-172-31-28-203: $ ssh-copy 172.21.92

so hv configured my remote hoste to be managed remotelessly
key 


38:21                  contd frm video2
**************** back to ansible modules

6) (Apt)  yum Module

Used to install a package in the ansible client.
$ ansible db -m apt -a "name=apache2 state=present" --become

$ ansible db -m service -a "name=apache2 state=started" --become

$ ansible db -m apt -a "name=nginx state=present" -b


                                              ROOT PRIVILEDGES   "-b"
41:05 ***** 

we need root priviledge to install a package  and  apt or yum will be used interchangeably  e.g yum for redhat and apt for ubuntu
so we use axommand called "become" to excalate our priviledges or a " -b " option , -b just means you wnat escalate the priviledges, w ewnt to use sudo prividege

ansible@ip-172-31-28-203: $ $ ansible all -m yum -a "name=apache2 state=present" --b
failled for the first ubuntu server
failed for the 2nd ubuntu server
also failed for the redhat server     *********** bc it couldnt find apache tool

*********  yes when we are working with yum module, apache tool is nt part of the yum repo, instead you need to install httpd 
httpd is the same package but its the package thats in the yum repository  bc were trying to install a package thats not  part of yum repository
so now we hv to change our package 
but if i still want to install apache then apache is a package for the pat repository or dibiam 
$ ansible db -m apt -a "name=apache2 state=present" --become
   this package is apcahe
but if am using yum i need to insatll httpd
$ ansible db -m yum -a "name=httpd state=present" --become
   thats the package for yum 

  ansible@ip-172-31-28-203: $ $ ansible all -m apt -a "name=apache2 state=present" -b
chnage is true
  succes for the first ubuntu server
change is true
success for the 2nd ubuntu server
But  failed for the redhat server  

####### 6iI)                                   
45:29
*************  *****************             IDEM POTENCY

if i run the caommand again  :
  ansible@ip-172-31-28-203: $ $ ansible all -m apt -a "name=apache2 state=present" -b

chnage is false                              *********** this is because the package has already been installed & so, ansible will nt install it again
  succes for the first ubuntu server
change is false                                         ********* this is called idem potency
success for the 2nd ubuntu server
But  failed for the redhat server  

   INTERVIEW QUESTION
WHAT is idem potency 

ANS:
Anisble does not reinstall  a package thats already insatlled or run a task that has already been completed 


###  6iII)
***************************** ABSENT 
 to remove the package ill say state is absent 

  ansible@ip-172-31-28-203: $ $ ansible all -m aptm -a "name=apache2 state=absent" -b

chnage is true                            ***********   pacakge has been removed 
  succes for the first ubuntu server
change is true                                       
success for the 2nd ubuntu server
But  failed for the redhat server  


*********** so now we see we can use yum or apt to install our packages


#### 6iV)
48:07 ************
                                    USING YUM 
to use yum , instead of all , ii use the grp name : web       ( we can use either present or latest)

  ansible@ip-172-31-28-203: $ $ ansible web -m apt -a "name=httpd state=present" -b
change =true

******** we installed using a yum moduel

********* so we hv apache(or he said package) module, apt module, yum module 
all these are ansible modules that you can use , modules are small programm that we are using 
all thses are package managers
we are using package mangers to be able to install package in our servers

48:42
***********
we can use a service module if we need to start our appl
we can install ngnix and we can start it by using a service module

#### 
   7) Service Module

You can use the service module to manage services running on the remote nodes managed by Ansible. This will require extended system privileges, so make sure your remote user has sudo permissions and you include the --become option to use Ansibleâ€™s privilege escalation system. Using -K will prompt you to provide the sudo password for the connecting user.

$ ansible all -i inventory -m service -a "name=nginx state=restarted" --become -K

$ ansible all -m service -a "name=nginx state=stopped" --become -K

*********** lets install ngnix on our db group
installing ngnix using apt

  ansible@ip-172-31-28-203: $ $ ansible db -m apt -a "name=nginx state=present" -b
change = true          installed

now to start the service                 ************* we need sudo priviledge to start it  so "-b"  , its only admin who can start it
  ansible@ip-172-31-28-203: $ $ ansible db -m service -a "name=ngnix state=restarted" -b
change=true
state = started

53:20
on the other splited part of the terminal
terraform output
we see our output
he copied one of the public ip of the host and bc ngnix runs on port 80
35.91.190.201:80    in google
we see apache runing on that particualr ubuntu
so we hv used service module to start the service 
we can still use the service module to stop it 
  ********  
  ansible@ip-172-31-28-203: $ $ ansible db -m apt -a "name=nginx state=stopped" -b
now the service has been stopped

56:18

############ 8)

8) User Module
Used to create user accounts.  (TO create users, but you wil first craete an encrypted pW for the user)
Create a password encryption
Generate the password from your local environment
$ openssl passwd -crypt <desired_password>

$ ansible db -m user -a "name=Peter password=wiyiMQbLhCRUY shell=/bin/bash" -b

                                ENCRYPTION , SUDO !!
eg 
 ansible@ip-172-31-28-203: $ cat /etc/shadow
permission denied 
 ansible@ip-172-31-28-203: $ sudo !!
we see the list  of paswords
we see ansible pW was encrpted, so pW are stored as encrypted in /etc/shadow file

eg                         CREATING A uSER

 ansible@ip-172-31-28-203: $ openssl passwd -crypt mark
unknown                                                           ********** he said openssl isnt installed


************ he went to the other part of his terminal
(base) - terraform files openssl passwd -crypt mark                       ********* bc he has openssl insatlled here his local env, the other part is his ec2 instance
psv/alszgssq                                                       ***********i hv encrypted the PW n it has been genearated,this is the PW we need to pass as encrypted

*********** back on the other part of the terminal 
using the user module , i will craete the user in the db grp
 ansible@ip-172-31-28-203: $   ansible db -m user -a "name=mark" password=psv/alszgssq shell=/bin/bash" -b
change=true                         ********   it has created a user mark
home : "/home/mark"                        created a home 
 password :                            NOT LOGGING PASSWORD            ******* so u cant use d encryted PW a sa login PW, what u nid to use is d decrypted PW(mark)
its saved in the/ etc/paswd thats why its encrypted

1:03:19
to see the encrypted PW , we need to ssh into one of the instances (so we left the control node)
psv/alszgssq   
ansible@ip-172-31-28-203: $  ssh 172.31.21.91
welcme to ubnuntu                                       ******* now in the home of ansible 
ansible@ip-172.32.21.91 :$ cat /etc/passwd
mark : /home/bin/bash
ansible@ip-172.32.21.91 :$  cat etc shadow 
permission denied
ansible@ip-172.32.21.91 :$  sudo !!
mark: psv/alszgssq                         encrypted but to login as mark , ill pass the PW as mark cos mark is the PW that we encrypted,
                                                 but when using an ansible playbk to craete a user u hv to encrypt d PW using openssl and then pass it 



####                           
9)   Setup module
This is a default module and is used to gather facts about the hosts.  egused to go to the host to gather facts, to find out wheter python has been installed, to find out
what package manager this server uses..... this is also a default module

The setup module returns detailed information about the remote systems managed by Ansible, also known as system facts.

To obtain the system facts for group1, run:

$ ansible group1 -m setup

This will print a large amount of JSON data containing details about the remote server environment.

To print only the most relevant information, include the "gather_subset=min" argument as follows:

$ ansible group1 -m setup -a "gather_subset=min"

To print only specific items of the JSON, you can use the filter argument. This will accept a wildcard pattern used to match strings. For example, to obtain information about both the ipv4 and ipv6 network interfaces, you can use ipv as filter:

$ ansible group1 -m setup -a "filter=ipv"

ansible@ip-172.32.21.91 :$  exit                    the ****** host instance/ansible home to go bk to the contorl node
ansible@ip-172.31.28.203 :$ ansible web -m setup                    ****** it will return info abt this redhat server
success
there are lots of info it returns , its called gathering fact

1:7:50
*********eg 
ansible architecture" x86_64
some othe facts returned are like variable sthat can be accessesed and we wil see hw to do that
if i wanted to,i can use a variable to find the architecture of my server, i can use it as a filter
therfor i can use my setup module and call these variables
ill say if ansible architecture"  is  x86_64 , i can pass condition like that 
then ansible will go out bc of the setup module, it will look for servers or host that has this architecture and those are the servers that its going to perform  a task on  

also i can lok at 
ansible _distribution : redhat                   ******** and we will be using this variables
i can say that i want to configure instances whos ansible distribution is redhat
eg 
when i was running the command that we were installing httpd or apache, i would hv passed a variable and say install apache if ansible distribution is debiem bt install 
httpd if ansible distribution is erdhat 
so the satup module will go out and check all your servers then whatevr dustribution it returns if the distribution is redhat its goin to install httpd , if the distribution
is debiam it will install apache 
so thats hw u can use ansible with a setup module to automate process to dynamically hv it go an install packages based on the operating system, we wil see hw we can do that

*******there are lot of varaiables, key value pairs that you can reference based on what you want
you 

ansible os family, ansible pkg_mg , so you can use all these as variables to filter out what resource sor server you want to maintain or configure 


1:10:41              ***************


To print only the most relevant information, include the "gather_subset=min" argument as follows:

$ ansible group1 -m setup -a "gather_subset=min"


eg
ansible@ip-172.31.28.203: $ ansible web -m setup -a "gather_subset=min"
 so it wont print out evrytin , just the most inportant, like a summary of all the vraiables you  can use reference


******** we can disable this setup madule by passing  a flag called gather facts = false 
we will see hw to do that in playbks 


          INTERVIEW QUESTION
whan you  pass an option like :gather facts= to false what module are you disabling

ANS: 
You are diasbling the setup module

















prof diff btw task and ..





 






















