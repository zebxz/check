 
1.10      
YES you wil need to need to hv a vpc that exists first but if ur nt using custom the it means ur using default and so u dnt need to passa any argument to ur resourec
trfrm wil place it in the defult vpc


AMIs are Region specific ................3:00:14   

my QUESTION: How do you know areas that have default vpc ????????????????

i cudnt install terrafrm                       ............... ASSIGNMENT: 1:25:30

38:00 , watch what he did .........
remember when u intialize terfrm , u nid to be in the dir where your files are 


########  am goin to intro u to anod IDE  i like using called itelligie     .............. 26:00
bt its nt any diff frm vscode

################################## frm me 
diff btw output and datasource
https://stackoverflow.com/questions/75246774/difference-between-data-source-and-output-block-in-terraform
i bliv an e.g of what a data source does is , bc when we are manually creating an instance we choose the ami first inorder to create the instance 
therfore, the data source gets our ami for us first then it inputs it into the resource blk bc we reference it in the ec2 resource blk we want to use to create the instance, 
thats my understanding of data source 
wHILE
output gives us the attribute of an already existing resource


USER DATA/BOOTSTRAPPING
  STEPS FOR CREATING AN INSTANCE/INSTALL HTTPD USING RESOURCE BLK WITH FILE FUNCTION FOR USER DATA(BOOTSTRAPPING) OF THE HTTPD ..ie user data contains the script to instal httpd 
ANALYZING THE INSTALLATION SCRIPT
TYPES OF TERRAFRM FUNCTIONS
USING MY IDE & GITBASH
 ACCESSING THE INSTANCE & THE DIR & HOW TO FIND META DATA OF THE INSTANCE
THERE ARE 2WAYS we can PASS DATA (Analyzing & provisioners)


######################################################################  START


user data, boot straping, terfrm has built in functions ,THERE ARE 2Wya we can PASS DATA, PROVISIONERS, passing a key ,secret/ .gitgnoire, meta arguments, TYPES OF META 
ARGUMENTS , IMPLICIT/EXPLICIT Dependencies, converting list to set of string



 the installation process might REQ u to do some research, some times ther are somethings that are nt straight bc of the env, but this is why as an engr you wil use the skills
that u hv, use u knowledge of research & script & finding out frm the documentation & frm the vendor what is latest, bc sometimes u may b given a script dats outdated, that was
used last yr, and as u try to run it u find out that its not working, so through research & things like that we actually learn/find out how to do things & how not to do 
specific things


1.34 HAVE YOU ENCOUNTERED ANY ISSUES WORKING WITH TERFRM

2.10 issue cloning repo using vscode
question mark on directory/s3 bucket (meta argument examples)
so she had to fork/ edith the name

5.30   it clones but its empty
said he will reupdate the repo at the end of class but he has already deleted the question mark
  student confirmed its working now


15:20
we use data sources to get info to return info for us frm an API, IF WE wnt 2 get info frm AWS, mayb frm a vpc, AN INSTANCE, a s3 bucket, this obj we wnt to get info abt,
first it has to exist, so we are getting inf from an obj that exists, so if we hv an ec2 instance tht exists we are able to get info abt the instance ,  the id ,
public addres, its dns bc the obj already exists,so we can use a data source and pass in our filters and we are able to filter out all d amis that are der and we are ablle 
to return jst the value of what we nid
we use data sources in automation bc as engr u dnt want to go to d console to manually copy an ami or any info/attribute,instaed u can automate d proces by runing a comand 
an data source wil go fast into aws , it wil get the attribute/info that u need n terrafrm gives u a way wherby u can aripolate that, u can pass d it directly to d resource 
ur creating

e.g 18.35
if we were  creating an instance, bc we hv a data source dat we are using, we able to directly pass that as our AMI, N what we are pasing is that attribute we wnt to get
. we knw that the AMI nids to b an id, so we ar using a data source as it reads data frm that particular AMI source, we wnt it to return an id n as it returns an id we are
directin paasing it to d resource so d data source gets the info n we pass it as an input to our resource n this is how we use data source to provision our resource 


                          WHAT IS USER DATA
Student; user data is a bootstrapping tool
proff; we are using user data for boot strapping, if we hv any info we want to pass onto our instance

                                         
21:00
INTERVIEW QUESTION
1)what is user data????
under whose/which persmission will the instance b boot straping???  ... it wil use root permission
we hv a root user whenevr ur instalin a package it wil use a root credential
2) what is booth straping???
the root user wil create ur default user and add them to d sudoers grp, that is the process of booth straping


eg; while creating an instance, we can pass a user data ie when the instance is created, i want some softwares to be installed in it
when u are passing user data, when the instance is boot straping, it wil be boot straping with some permission
when u are boot straping an instance like linx or ubuntu, der wil be a default user who is created, that is an ubuntu user
but who creates the  ubnuntu user when the instance is creatin,???????????????
there is root ,
the root user wil create ur default user and add them to d sudoers grp,that is the process of booth straping  so that this ubuntu has
permission to do what root can do
so when ur boot strapin and ur using user data , the user data wil use root permison, terfrm also gives us that option
*************************  24:30 ...




                                      TERRAFRM ALSO GIVES US THE OPTION OF BOOTSTRAPPING
           
whenever we boOtstrapping an instance 
eg we want to create an instance , in google he type aws_intsance terrfrm 
When i go to the registry, i see the arguments
we see d arguments in alphabetical order and we scroll down to  see user data , so i see i can pass in user data as a script,i can pass in as commands 
dat terfrm wil use when its boot straping dat instance , it is going to create the instance


                 INTELLIGIE IDE
am goin to intro u to anod IDE  i like using called itelligie , its open source    .............. 26:00
bc of hw it organises my dir n files n am abale to easily look at my files like this
bt its nt any diff frm vscode
I always prefer intelige, than vscode just bc of hw intellige has beeen setup
U CAN STILL Use ur vs code if u hv it , IDE is jst an integrated development env, der are multiple IDEs u can wrk with
it jst depends on your preference
as u continuie working u can xperiment on diff IDE n find out the one u prefer Bc they all work & do the sme thing
intelligie is open source , theres enterprise version but thers community version which is free
********* for d sake of dis am goin to continue wit inteligie n put away my vscode bty its nt diff



  STEPS FOR CREATING AN INSTANCE/INSTALL HTTPD USING RESOURCE BLK WITH FILE FUNCTION FOR USER DATA(BOOTSTRAPPING) OF THE HTTPD ..ie user data contains the script to instal httpd 
 we are still using the resource blk to create an instance & inside the resource blk we are using the 'file function' to refer to the 'user data' we are using to install httpd

Step1;      RESOURCE BLK FOR INSTANCE
**********28:20
creating the instance cont.d
      ... am looking at my examples here
i hv a data source for an amazonn linux 
a resource for an instance i wnt to create
am nt hardcoding the value of d AMI, i using a data source to get my AMI
i can use a variable and call it  "instance type" .............................29.30
then i refer to this variable i created


   Step2;           INSTALLING WITH USER DATA.... app1-install.sh
#! /bin/bash
# Instance Identity Metadata Reference - https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-identity-documents.html
1)sudo yum update -y
2)sudo yum install -y httpd
3)sudo systemctl enable httpd
4)sudo service httpd start
5)sudo echo '<h1>Welcome to Landmark Technologies</h1>' | sudo tee /var/www/html/index.html
6)sudo mkdir /var/www/html/app1
7)sudo echo '<!DOCTYPE html> <html> <body style="background-color:rgb(250, 210, 210);"> <h1>Welcome to Landmark Technologies</h1> <p>Terraform Demo</p> <p>Application Version: V1</p> </body></html>' | sudo tee /var/www/html/app1/index.html
sudo curl http://169.254.169.254/latest/dynamic/instance-identity/document -o /var/www/html/app1/metadata.html


                                ANALYZING THE INSTALLATION SCRIPT
above is the user data (a bash script called app1-install.sh) to install httpd , am starting the service
5)am ruuning this script to echo welc to landmark in the index.html file: echo "<h1>Welcome to Landmark Technologies!</h1>" | sudo tee /var/www/html/index.html
6)then ill also make a dir called /app1, in var/www/html
7)then ill echo a diff colour sayoing wel to landmark application app1, into the index.html file
8)am also goin to curl the meta data & dump them in the app1, in a part called meta data
so this user data becomes my script that will booth strap when the instance starts
**************    am passing the user data as a file  and the file is in the PWD and its called app1-install.sh"

*********  50.00..... at this point We accessed the instance & the dir online


Step3;  WATCH ............32:08
  xplantion cont.d                              TERRAFRM FUNCTIONS
   .. whenevr u use data ull pass it as a file, this is a function
in terfrm, it has what is called functions
if u google terfrm funtions , terfrm has built in functions ,   ther are various function for diff purposse
you can use dem to manipulate data 


                                  TYPES OF TERRAFRM FUNCTIONS
Numeric function eg; Max, it takes one or more number & returns the gratest frm a set, so i can u use a function like this juts to return number frm a list 
lower function, split function, collection funding, coding function, least function, file function 
we can join diff functions

file function;
file reads the contents of a file at a given path and returns them as a a string
so when u use a file function , u wil nid to give it a path
we hv an example below
> file ("${path.module}/hello.txt")    ...... path.module indicates the file is in the PWD and then the name of the file ur passing
so the file function will read ("${path.module}/hello.txt") and return the content of that particular file     .....................................34.20
****now back to his INtellgie ide

xplanation cont.d
the user script we want to use for installation is in the pwd, if the file was in a diff dir, i just need to give terfrm the path , just specify the path
but right now ; referring to the resource to create the instance; We see this user data line 
user_data = file("${path.module}/app1-install.sh")   ... this states that the user data file is in the pwd & the app is called app-install.sh
& its going to install it as user data
we can also see my providers .....



                            USING MY IDE & GITBASH  38.25.. tab helps to auto complete
anoda tin i will like to introduce to you guys is that i can open my IDE from here,
but as u begin to work esp in d industry u wil see that many engr prefrer to hav a terminal,that runs their code 
eg u can open ur gitbash , as long as ur in the same dir
38:00 , watch what he did .........
remember when u intialize terfrm , u nid to be in the dir where your files are 
on
so i am using my terminal ie gitbash to run but am using the IDE to edit my code 
and i can hv them side by side & see whats happening in my ide & make my modification on my ide bc i am in the same dir
on my git bash i can continue by running , validate, fmt, plan . 
my data source wil always run first & it returns the AMi id frm us west2& it dynamically passes it as an id bc thats the attribute that i wanted to get



41.07                               TROUBLESHOOTING WRONG ATTRIBUTE
lets say u didnt knw what ur doing & u pass the wrong attribute eg instead of id , i pass ARN
Lets check what attribute we can get from an AMI .... 
in google.. aws_AMI terrfrm, i want the data source
but all am interested in is the attribute, what can be returneded it wi
42.40 .. we see lots of attribute including (image id - ID of the AMi, should be the same as the resource) he said its the same thing
 so instead of id, i pass arn 
Lets see if how terfrm will handle it
terfrm plan 
had to run upgrade because he changed the version
we see it returned the Ami, even though we requested for Arn
he also tried with the architecture & it was returned
               ERROR
but if i run terfrm apply, its going to fail because the instance expects an id not the Arn or architecture
so i hv to correct it ot get the AMi id 


                               ACCESSING THE INSTANCE & THE DIR & HOW TO FIND META DATA OF THE INSTANCE
once it creates the instance, its going to bootstrap it with the script & once its the script has been bootstrapped
it has completed
we see the id of the user data that it used 
instance was created in us west2
49.47
now he went to the aws console, & we seee the instance is still bootstrapping 
running all the checks
once the check is done we can we use either the public dns or public ip to be able to access it

50.20
1) TO ACCESS THE INSTANCE: he pasted the public ip: on port 80 (35.90.0.113:80) in the browser and we see .. 
Welcome to Landmark Technologies   Ie we are just echoing it into the index.html
2) ALso we created a dir, TO ACCESS THE DIR called app1: 35.90.0.113/app1/ , we see: Terrafrm demo Application v1
 <h1>Welcome to Landmark Technologies</h1> <p>Terraform Demo</p> <p>Application Version: V1</p> </body></html>' | sudo tee /var/www/html/app1/index.html
3)  METADATA.HTML, to return the metadata of of the instance :35.90.0.113/app1/metadata.html 
    the meta data of the instance can be found at this address, :  http://169.254.169.254/latest/dynamic/instance-identity/document 
WE run the curl commnad: we curling the address (its a public address) to find meta data of the instance 
53.27      so we are curling: :  http://169.254.169.254/latest/dynamic/instance-identity/document  &  putting our meta data -o /var/www/html/app1/index.html
    AND Thats why when we acces it we are able to find our meta data: the image id, the instance id, region USwest
55.55...  this is set, amazon sets, this is the number amazon provides if you want to get any meta data... /169.254.169.254/latest/dynamic/instance-identity/document
***so we have been able to use/pass user data & bootstrap onto our instance while the instance is creating, & we did it using user data




54.13                  THERE ARE 2WAYS we can PASS DATA
1)CONFIGURATION
in the example we just illustrated above, we see that it was part of configuration, trefrm did provisioning , it provisioned our instance but not only did it provision it
it also configured  it
the process of configuration is when ur installing softwRE, 
SO TRFRM gives us a way that not only can we provison our infrsastruture bt we can also configure it 
so this is alos part of config mgt, we can use a script, we can use user data to configure it 
but as we go on ill show u anoda way wich we call PROVISIONERS
2)PROVISIONERS
So trfrm can also give us a second method in which we can config our infarsture by using PROVIONERS ........................................55:11
    BUT AS U LOOK TRU documentation  , IT SAys use provisioners as a last resort
its nt the most recommemded way to do config bc of the nature of what provisioners do,
bc if a provioner fails, it will have to destroy the resource for it to be created again
thats why provisioners is a last resort
so if u want to do any config on ur instance esp as bootstraping then u can pass user data as a script



QUESTION
57.00   ... HOW DO WE GET THE ARN, HV NEVER SEEN THE ARN AND HOW WE CAN GET IT 
  THat illustration we did with arn, was just for demo purposes


1)what do we do when we dnt knw the right attribute to pass???

ANS;
jst depend on documnetation whener u are lost or smt isnt clear, like ur nt sure of what attribute (ie for what you need to return as an output) or argument ur supose to pass
just cm to d dcoumentation n just look at arguments and attributes, you will see what is required & whats optional
eg for a Natgateway, in google type aws_Natgateway and you can see what argument is required


2) we tried to create instance using a file but when we tried to create anoda instance and we changed the resource name to mk it unique, we realise that it destroys the first
instance created, does that mean one file for one instance

***I Think the simple answer he should have given her is, you can use one file but with diff resource blk & diff resource name. or using the same resource name using arguments
                                                                                                                        as we will see subsequently

ANS;
THats why we said in the first class that, you can create as many type of instance as possible but what must be unique is your 'resource name' 
the name must be unique to trfrm bc trfm keeps a state file
eg terfrm state list .. this list the resources i have
SCENARIO 1: 2 THE Same 'resource type' eg 2instance, with the same resource name (mee, eg you delete or change the previous resource blk to use it to create the 2nd instance)
when u try to create a 2nd instance wit the same resource name, when trfrm compare the state file (the file trfm stored frm ur previous configuration) n your new congiguration
file, it doesnt doesnt find the initial configuration file bc u changed/deleted it so it sees that as a drift, my configuration doesnt match my v wall, & so terfrm will try to
destroy what it was managing before but now doesnt exist, so that it creates the new one 
eg , if i run terfrm plan, it refreshes the state file, ie the ec2 instance, the pevious one so always make sure the name is unique, mee,
**mee 
SCENARIO 3:   2 THE SAME RESOURCE TYPE' (eg  2 'ec2Instance') with unique names   ..2.0.7.00 but instead of this we can use 'meta argument; 'count'
               will work.. just have the 2 seperate resource blks
1.51.35 .
 SCENARIO 2:   2 THE Same 'resource type' eg 2instance, with the same resource name  ...(with 2 resource blk) 
 terfrm will say duplicate resource
SCENERIO 4:  2 DIFF RESOURCE TYPE  (eg; ec2instance & vPC), with the same name 
                  will work bc they are diff resources

when we look at meta data shortly frm now, we will see we can create a resource even with the same name 
how we can cerate multiple resources even with the same name  , how terfrm handles that using meta arguments    ............... 1:10:50



                                           SUBNET/HOW TO GET SUBNET ID
1:10 .00 
We knw that instances are created in subnets, if i dnt specify a specific vpc it will place it in the default vpc, it wil select a subnet in the default vpc & place the instance
BUT; 
if i want to place it in a specific subnet then ill go to the documentation & scroll down to ec2 instance 
so for an instance what argument can i pass, i want to see if i can pass a vpc or a subnet to my ec2 as an argument
so scroll down  & i see a subnet id, its optional but its a vpc subnet to launch in
so if i hv a speecific subnet id , i wnat thais to launch in , i can pass thais as an argumet
then in my resource blk ill pass 'subnet id' & bc its a string, 



1.14                      TO EGT THE SUBNET ID FOR A CUSTOMIZED REGION/REGION THATS NOT MY DEFAULT REGION
 First the vpc should have already been created
so ill go into to AWS, in the vpc i want; ill copy  the subnet id and paste it in my resource blk but thats hardcoding, bc hv gone to the AWS console & pasted it
terfrm plan, we see it wants to destroy the prvious one, bc we are changing from the previous subnet (default) to this new  subnet(customized) region we want



      1.19.20               DATA SOURCE TO RETURN SUBNET
    WE illl need the vpc id or use filters
but as we go on ull see, that  an easier way, if you are nt creating it in a default vpc then am creating it in a custom vpc & when u craete a custom vpc, u create outputs
for your subnet, output for vpc id, anything you wnat to get from your vpc, then we ill use those output to become inputs for our resources
shortly we ill see hw to do that
in conclusion we can use data sources to return info frm our vpc & use them as input into our resources



3) do we need to create the vpc first if we want to create our instance in the customized vpc?

ANS:
 1) DEFAULT VPC
if ur trying to create your inatnace in a region that does nt hv default vpc then ull neeed to specify which vpc u want to place it but if a region has a default & you dnt pass
a subnet where u want to place the instance, terfm wil place it in the default vpc, any subnet in the default vpc, default vpc wil generally hv public subnet, so it will pick 
up one of the public subnet in the default vpc &  place the instance there
2) BUT FOR CUSTOM VPC
YES you wil need to create the vpc first then place your instance, & we will see hw to do that shortly frm now, create our vpc & use the info frm the vpc to create our instance
but if ur nt using custom the it means ur using default and so u dnt need to pass any argument to ur resourec trfrm wil place it in the defult vpc

    So we hv seen seen we can usee terfrm to create our instances/resources & use user data to bootstrap our resoure
also remember once you are done, bc u hv the code, run terfm destroy/ terfrm destroy -auto- approve, so that u dnt incurr charges




use a user data

1:26:41        PASSING A KEY .............. a key need to associate with ur instance  ............... WATCH

first i need to look at my provider 
the provider is in us wwest2
i neeed to go to my aws console , sign in amd mk sure am in west2
i need to look at the key pairs i have in that region 
in terfrm registry, i look at my documentation, hw do i pass a key , i look at my arguments , scroll down to aws instance then scroll to argument; key
so i can either create the key or pass a key name if i hv it, bc i see the argument am suppose to pass called; key_name
so in my resource blk i pass key_name: 
so if ur passing a key, always make sure you that the key exists and the key is in ur env , for e.g in dis case, its west2
if the key is nt in that region, it will say the key cant be found


                                                 CREATE SSH KEY GEN
we will see how we can create our key using the ssh key gen command and u can create the private/public key on ur terminmal and pass the key to terfrm n terfrm wil associate
that key wit ur instance bc u wil have both ur private key in ur env and it wil tk the public key and attach it to ur instance at ceration



                                     STEPS TO USE THE .GITGNOIRE FOR CREATING SECRET
                                        
1:354:00  .gitgnoire file for creating a secret
1)first i create a variable & mk it as sensitive; can give it any name eg secret , type =string , sensitive =true
2)Then create a terfrm.tvars file eg secret.tfvars
mayb i need to pass a pW for a database & i dnt want it to expose it in my code
then inside the file ill pss; e.g db_password = "landmark123"     
3)create gitignoire file
then inside my manifest (i bliv the folder for all the files ie module,provider,  appinstall.sh, secret.tvars) i create a .gitgnoire file
inside the gitignoire ill put the secret.tvars 
meaning i dnt want the secret file to be commited to my repository bc it has my secret, its sensitive
so whenever am committing the (ec2 instance file) to the repository, i dnt want the secret file to be commited
when i go to run  terfrm apply : terraform apply -var-file=secret.tfvars
so am passing it as a command line option
then when i come to the state file, we see evrryting is plain & if i had passed a sercet u will see it in plain text
but now bc of my variable i created &nmarked as sensitive, when term create sthe statefile it wont capture/expose the values of the secret as plain text 

but if am working with a team, ur working collaboratively, ur using .gitgnoire (inside  the .gitgnoire file, he refered to the secret file he wrote: secret.tfvars)
so am passing .gitnoire, if i push this code (the .gitignoire)to you , u will not hv dis file the secret file, so u wont be able to see it
i creat my variable n mark it as sensitive = true so when trfrm create the statefile its nt going to output the value of d variable, its nt goin to be captured in d statefile 
as plain state , otherwiae anyone who has access to ur statefile are able to see ur secret
any thing u dnt wnat exposd, u mark it as senesitive n terfrm will nt expose it as an ouput or within ur statefile


***1.40.40, reload all from disk.... will show all your files 



     1:44:30 
                         
                                  META ARGUMENTS   ............... REFer to note file in github
so far w ve been dealing with  Aruments 
Arguments are what we pass into our terrfm resource  when  we wnt to create a resourec or when we wnat to get data, uisng data source , we can use argument but terfrm also 
has whats called meta argument

META ARGUMENTS : these are arguments that alter the behaviour of a a resource , they dnt change  d resource they only change hw it behaves


INTERVIEW QUESTIONS  , WHat is meta arguments
hv you ever worked with a terfrm argument?
can you explain to me how you've used depends on or count for each provider life cycle meta argument in your env
  ANS:meta arguments are what i pass into my terfrm resource to alter the behaviour of hw the resource behaves

   ther are 5types
depends on
count
for_each
provider
lifecycle

your understanding of hw these wrk wil help u to easly wrk wit trefrm bc u can moduleize ur code or create dependecies, u can reduce ur code to 
10lines of code bc u hv meta argument that can create resourCEs jst based on the conditions that u pass


1) depends on:
trfrm has a feature of identifying resource dependency. this means that tfrm internally knws d sequence in wich d dependant resources needs to be craeted 
wherEas the independent resources are created in parrallel.
ie if u have 2resources that are depndent on each other, terfrm internally has a way of identifying wich resource has to be created first b4 the other , 
This is called implicit dependency

 

   INTERVIEW QUESTIONS, 
What are implicit dependencies???

ANS:
THis is a situation wherby terfrm internally identifies d dependencies of resource n therfrore its able to identify which resource to create first, so it is abt dependencies
so if u dnt pass any depends on argument but tefrm still organizes which arguments needs to be created first then that becomes implicit depencies, its an inbuilt functionality
of tfrm that identifies which resource nids to be created first 


EXPLICIT DEPENDENCIES
but sometimes, there are resource you as an engr, now that u understand the use of terrfm, you yourself want to detrmine the order in which resources will be created
this is when u determine urself manaually the order resources are created 
this is done by passing a depend_on meta argument
depends_on meta-argument must be a list of refernces to other resources in the same calling resource.


                IMPLICIT  DEPENDENCY ILLUSTRATION
1.51.00   he showed an e.g,
inside the instance resource file, he craeted a resource blk for vpc
we can chcek the documentation for arguments we can pass in a vpc eg cidr
so i pass an argument for cidr i want to pass
so in our resource file/data block we have a resource for an instance, and a resuorce for a vpc 
terfrm plan 
and we see the plan is to first create the vpc and then the instance, then are both been created at the same time 
 we see vpc creating the resources in parrarel ie  both the instance n the vpc created all together .. .1.57.16  
ie we can see ec2 still creating while the vpc is also been created
then finally it created the instance then the vpc
terfrm destroy, 
they are both been destroyed together


1.56.25 vpc capacity is 5..
lets create some dependencies
                                 
2.00                          EXPLICIT DEPENDENCY ILLUSTRATION
i want the vpc to depend on the instance, 
so that means the vpc can only be created after the instance has beeen created
so in my vpc i can say that this vpc depends on, depends on is a list  = the aws instance 
we pass it as a list bc we can put multiple arguments in there
depends on = [aws_instance.myec2]
can run terfrm format so it formats the code 
thne trfrm apply 
and we see its first goin to create the instance first bc hv set a dependency
we dnt see any vpc creating as it did earlier
so have altered the behaviour
so after my instance have been created then it can then create the vpc 
this explicit dependency, am defining hw i want my resources to be created
but lets say i did it a diff way
if i wanted my vpc to be created first, once the vpc is created then i want the instance to be placed in this particular vpc as a subnet, so with that i wil create depenencies
ill say my instance depends on the vpc ....
so my vpc will be created first, once it available then my instnace , i can get a subnet id, i can now use a data source, i can get a subnet id for that particular vpc to
place my instance
so now once i do that am creating depsndency and terfrm is able to figure out how to stretch it so it detr which resource will be created first

    *********** depends_on meta-argument must be a list of refernces to other resources in the same calling resource.


                 ec2instance.tf file

    resource "aws_instance" "myec2" {             ** the ec2 instance resource blk
ami           = data.aws_ami.amzlinux2.id
instance type = var.instance_type     
user_data    = file("${path.module}/app1-install.sh")         
tag = {                                                               
   "Name" = "EC2Demo"
 }

variable "instance_type" {                 ***the variable resource blk
   type = string
   default = "t2.micro"
}

 resource "aws_vpc" "myec2" {                     *** the vpc resource blk
   cidr_block = "10.0.0.0/16"
   depends_on = [aws_instance.myec2]    ******** bc this is a list we can mk reference to more reosurces if we need to 
tags = {
   Name = "my-test-vpc"
 }
}
bc its a list u can pass as many resources as u want as long as this particular resource depends on them, so u can pass it as a list

    ******* so this is the first meta argument              ....... 2:04:00



2) count          *****  this uses an index
it can be specified in resources as well as modules 
in trfrm a resource blk actually configures only one infrastructure obj by defaault.
if we want mutiple resources WITH THE SAME configurations, we can define d count meta-argument  ie we can use count meta argument
we are redefining how that particular resource will behave frm the default , we are deviating it frm the default nature of how terfrm will handle it
so this reduce the overhaeds of duplictaing the resource blk that number of times
eg instaed of duplictaing by copying the code/resource blk then paste , which means i hv a duplicate resource which means too many lines of code to maintain 
so instead of doing that, terfrm gives an easy way to do it by using a meta argument, which alters hw the resource wil behave
ie with count meta-argument , so this overrides the default which i one
e.g, so if i want to create 3instances, instaed of dupicating the resourec but i hv to change the name (myec2)
    bc of this am nt changing any configuration, am only changing the name which is local to trefrm
so if i want to create 3instances, ill pass count in my resource blk,
count requires a whole number and it will create the resourec that number of times
then to distinquish one instance frm the other, i hv to pass an index, the index corresponds to each resource 

count = 3     ... that is it wil craete the resourec 3times 
   e.g

  resource "aws_instance" "myec2" {
count = 3
ami           = data.aws_ami.amzlinux2.id
instance type =  var.instance_type     
user_data    = file("${path.module}/app1-install.sh")         
tag = {                                                               
   "Name" = "EC2Demo)"



***************but to be able to identify each of the created resource we pass a count.index , the index has to be whole numbers
if i create 3 of these, i need to distinguish one from the other so bc of that ill need to pass count.index,i need to pass an index which is the index number that correspond
to each resource
the index ranges from 0 t0 -1
just like a list,
our list always starts with 0 index
so if i want to create 3 instances 
count = 0, 1, 2

e.g     ,.... # create four similar EC2 instances

   resource "aws_instance" "server" {
  count = 4 
  ami           = "ami-a1b2c3d4"
  instance_type = "t2.micro"

  tags = {
 #usage of count.index in providing a distinct name for every instance
    Name = "Server ${count.index}"
  }



             ec2instance.tf file  with count illutration
resource "aws_instance" "myec2" {
count = 3
ami           = data.aws_ami.amzlinux2.id
instance type = var.instance_type     
user_data    = file("${path.module}/app1-install.sh")         
tag = {                                                               
   "Name" = "EC2Demo-${count.index)"                          ********* with count.index, thats how terfrm wil identify this as multiple/ different resources 
 }

variable "instance_type" {
   type = string
   default = "t2.micro"

*****2:09:00
subsequently when we run terfrm plan, terfrm inputs the index 
the instances wil be   ...................
myec2[0}   .....   ie  index 0
myec2[1]   ...... ie  index 1
myec2[2]   ....... ie  index 2

   so thats how terfrm wil diffferiante this resources from each other 

the name that will be captUred in the statefile will have the index indicated
so we using the same code to create multiple instances 
when u look at the ami, user data, the instance type are all the same 


2.13.30


************************ LIMITATIONS OF COUNT ***************
bc count uses an index 
for e.g we created 4 instances and then i remove/ delete one instance from the list , count will try to reindex all the incidents instance and it wil delete all and then
recreate all again bc the index has to be frm 0 upwards.
also if go in the middle of the list and u remove an element frm a list then it means all the subsequent element needs to be resequenced
ie u removed index 2, so index 3, 4, 5 hv to be reconfigured to make the arrangment of the numbers accordingly
also count meta data cannot b used with for_each

so bc of that trfrm also has anoda argument called: 

3)    FOR EACH   ............... THIS is more flexible        ...............2:17
  this accepts a map or set of strings. 
so if you have a map or a set, then u can use for each,
tefrm wil create one instance of that resource for each member of that map or set. 
to identify each member of the for_each block,
we have 2objects:
each key: the map or set member coresponding to each member
each value: the map value corressponding to each member.


e.g resource "aws_instance" "myec2" {
for each = var.instance_type                    ************* we wnt the instance type to be for each  
ami           = data.aws_ami.amzlinux2.id
instance type = so instaed of this: var.instance_type     ***********we change it to : each.value   ... (we set the instance type as we want the value)
user_data    = file("${path.module}/app1-install.sh")          ie for each of the list (t2.micro", "t2.medium", "t3.micro) we wnt the instance typ to b for each
tag = {                                                               so for each one the instance type wil be the value 
   "Name" = "EC2Demo"
 }
}

varaiable "instance_type" {
    type = list(string)             ********** now for each, we have a list of string, .... mico, medium, t3micro 
    default = ["t2.micro", "t2.medium", "t3.micro"]           ************ list of my instance type 
                                                    bc i hv this list i can use for esch, so for each of this element in the list, trfrm can create for me an instance 
                                                        for each of this, hw do i do that????  in the instance resource block, instaed of count, i can use for each 

bt we say that for each accepts a map or a set , this variable inatance is a list , for each doenst work with a list 
****************************************so  this wont work bc for each works with either a map or a set of strings 

to confirm
run tefrm plan and we get an error : invalid for_each argument 

****************** so bc of this we can use a tefrm function to convert our list into a set of strings bc we cant convert to a map bc we dnt hv key value pairs in here.



     CONVERTING LIST INTO SET OF STRING
we have a function called to set 
its used to convert a list or a map into a set 
 e.g

resource "aws_instance" "myec2" {
for each = toset(var.instance_type)
ami           = data.aws_ami.amzlinux2.id
instance type = each.value            ************** but if its a map : each.key , you supply the key then it wil return the value
user_data    = file("${path.module}/app1-install.sh")        
tag = {                                                           
   "Name" = "EC2Demo"

terrform plan 
and its successfull

so this how we use meta data for hw a resource behave or hw terfrm handles a resource.
  ********** this is more flexible bc its not using index, bc of this for each is more powerful meta argument to use if u have a list of varaible that u wnat to loop over
so i can pass my list of string 

so this is hw we use for each to alter the behaviour of resource or hw tarfrm handles a resource.

2:29:00   ********************* but if its a map : each.key , you supply the key then it wil return the value of the key supplied.



4) provider     
specifies wich provider to use for a reosure. this is useful when u are using  multiple providers wich is usually used when u are creating multi-region resources.
for diffrrntiating those providers, u use an alias field.
the resource then reference the same alias field of the provider as provider.alias to tell wich one to use.
e.g when i wnt the use the europe region then in my resource i wil specify 

# default provider
provider google
  region = us-central

## Another provider
provider google
  alias = europe 
  region = europe-west1

## Referencing the other provider
resource "google_compute_instance" "example" {
  provider = google.europe                         .**********in my resourec i wil specify the provider

also another e.g
i hv a resource for an instance and a resource for a vpc 
if i want to creste the instance in us east1, then i v defined an alias below
then in the instance ill define my prorvider as aws.east
why bc i hv a vpc that wil be created in west
bt for the instance v pass a provider wit an alias that wil alter wher the resource wil be provisioned

resource "aws_instance" "myec2" {
 provider = aws.east                     ************* here ill pass the provider
for each = toset(var.instance_type)
ami           = data.aws_ami.amzlinux2.id
instance type = each.value           
user_data    = file("${path.module}/app1-install.sh")        
tag = {                                                           
   "Name" = "EC2Demo"


varaiable "instance_type" {
    type = list(string)
    default = ["t2.micro", "t2.medium"]


resource "aws_vpc" "myec2" {
   cidr_block = "10.0.0.0/16"
     depends_on = {aws_instance.myec2}


provider "aws" {
   alias = "east"
   region = "us-east-1"
}

    therfore , with this, your vpc wil be in US west bc i hv my provider, it wil tk the default provider 
but the instance will have an alias so wil be created in east 

*************2:39:10  ............... 
run terfrm plan 
we got error : invalid AMI, not found 
he said hes nt trying to troubleshoot, hes trying to establish why hes getting that error 
someone suggested that we calling resorces that was created in diff region,  west, to be created in east
so it doesnt recognize bc ami,ec2 are region specific thus the error

**************** he said
right now we are trying to create a resource in us east1,
we hv used a meta argumet wich alters the behavior , by default the resourdewil be craeted in d default region bt it wil also use thsis data ssource to get our AMI BT 
BC WE pass a provider, this data source is using d default provider to query that particular data. its trying to find data in us  west bt when it returns that particular
data, this AMI is nt found in us East1

2:44 :00 ************* so we need to find out can you pass a provider alias in a data source????
can somebody go to the provider and find out
so this is your first project at work so how can you pass it?? 

ANS:............   2:50:00
she saw it under meta data sources
data sources
aws_regions

that we should use :
bc the documentation says, it enables all the region so that u check for the resources across regions
so in the data source , he added:

data  "aws_region" "current" {
  all_regions = true

   terrafrm apply but we still get error 
prof said:
we are tryin g to call a data source bt how are we referencing it, passing it ?    ............2:53:05

ANS:
in the data source,where we have our resource to get our AMI , he added provider = aws.east
data "aws_ami" amzlinux2" {
    provider = aws.east
    most_recent = true
    owners =   ["amazon"]
    filter {

terrafrm plan ...... successful   ********************* this is the solution 
but terfrm apply and vpc not specified errror
this is bc in us East(where i want my reources to be configured, i dont have a default vpc 
thi s is jst a basic question to see how we use meta arguments wich alters the default behaiour of our resource
the default behaviour of this data source is that it will use the default provider which is us west2
bt bc v congigure an alias, i wnat my resources to be configured in a diff region us East, therfroe we v to manipulitae d data source to use d same provider as our resources
so, data source has to go to into us East bt unfortunataely we dnt hv a default vpc in US East 
************* so the rectify the issue he changed our alias region to a region that has a default vpc
in the provider he chnaged the providr alias to US west, region = west-1
in the data source for instance he cahnged the provider to aws.west
in the data source for AMI, he changed provider to aws.west

terffrm plan 
terfrm apply .............. successfull.................. 2:57:13
vpc was created in oregon west2 but the instances were craeted in california , west1

so we hv seen hw we can use provider as a meta argument to manipulate hw our resources are provisioned created.
tru troubleshooting n finding errorrs , this hw u cm to findout hw things work.  if u find errors like that dnt freakout, just understnad d concept.
the basic concept is that AMIs are region specific
*************if tefrm gives u an error thta an AMI is not found , jst knw that ur are in the wrong region.
###############################if ur usin a data osurce, a datasource shud always return ur AMI , and a datasource  wil use d provider, the region of the provider that is the 
default region that your datasource wil try to query the data from , bt if u hv used an alis , if one of ur resource has an alias then ur datasource wil always try to query
data frm ur defult region that is set in ur default provider bt if u ve an alias, uv configured a provider alias then u hv to pass that in your datasource so that ur 
specifying the region ur datasource shud query or get the data.

5)  LIFE CYCLE
   A life cycle defines the life cycle of a resource. as per the resource behaviour , tefrm can do the following:
create a resource destroy a resource updated resource in place update resource by deleting existing and create new.
lifecycle is a nested block unde rresource that is used to cutomise that behaviour 



   CUSTOMIZATION THAT ARE AVAILABLE UNDER LIFE CYCLE BLOCK
A) Create_before_destroy :(Type: Bool)  ... u pass it as a bullion ,, the default nature of trfrm is that it wil destroy a resource then create bt in prod if u dnt wnat 
that to happen, u dnt wnat downtime , u wnt u infrasture to be created first then you can protect ur infrastu using life cycle meta argument
you can pass create_before_destroy = true 
b) prevent_destroy: (Type:Bool)
c) ignore_changes (type list (Attribute Name)

******************** 3.06:05
if we ar to chnage our instanec frm t2 micro to t2 medium,
we knw that when u chnage your instance type or AMI , its like your opearting system , wich maps ur cpu n memeory,that particular instance wil hv to be destroyed, tefrm 
cannot just update but 
if its tag, if i change it, trfrm  can modify it , if i run the plan , iil seee trfrm wil try to modify it in place, memaing its updated frm this to this , it doesnt hv
to destroy the instance

but if  we ar to chnage our instanec frm t2 micro to t2 medium, and run trfrm plan,
we see plan : 1 to add , 1 to destroy
trfem apply 
then we see it first starts to dsetroy and at the same time, its creating
but we dnt wnat hsi to hpapen in prod  bc ur imnfrasture is been destroy n bc of that downtime

*******************  3:10:00
A) to prevent thsi in our resource block u can pass a life cycle meta argument

life cycle{
  create_before_destroy = true

trfrm apply 
it showed destroying
creating 
then destroying multiple times 
and finlayy it took 1sec to destroy and 4ms to create 
so he said technically thats still a downtime 

************* but at the end of the class,  agirl showe has and it showed created 31sec b4 destroy 43sec
and prof said yes thats hw its suppose to wrk bt his system has jsut been acting up 


B:
life cycle{
  prevent_destroy = true

trfrm apply 
error: ccannot be destroy , says its protected by a life cycle
so it altered the default bebaviour of the instance 

but the documentation says u can bypass that plan by using -target
terrefrm destroy -target 
so i can target the specific resource i wnat to destroy

he targeted a vpc and successfully destroyed it
but when he tried to target an instance that has an applied life cycle, it couldnt

when we run tereraform state list 
we see we no longer have the targeted resourec 

C)
YOU can play around and see hw it works


  that is the main, when u understnad how this meta arguments works then trefrm wil become very easy bc when when we start writing code n we using functions ,
we usidng meta argment like e.g for each", we are able to loop over code , we are able to careet multiple resources with few lines of code
if i have few lines of code that code is easy to read and miantain , u are less prone to mk errors bc u hv very few lines of code 
instaed of me writing a 100 lines of code to deploy 10 ec2 instances, i can write 10 line sof code using  meta arguments , using loops n the code can easily be read, it
easy to maintain and less prone to errors.


what we left for u to know is terfrm backend 
what we ve ben doing, as we v been writibg and genetaing codes, trfrm has been storing our state file
this is the stae of our infrasture , it stores this state file in ur pwd 
this is cllaed a localbackend
a backend is wHer terfm opretaons hv been happening
and trerm has been downloading our providers here and its stores its state file in ur pwd , wher ur runing trem and it also has a backup of ur statfile inaces ue 
mainstate file gets corrupted bt thsis state file are in ur pwd , 
so this is calle da loacl backend , so sofar we v ben using a local backend





   INTERVIEW QUESTION
what are the type of trfrm backend that u are familair with ? 
NOW we knw what a loscal backend is ..............

when we meet nxt we will see what a remote backend is 
we will create an s3 bucket and be able to push our trfrm statefile to  the bucket
so we will use an s3 bucket a sa remote storage, so it will be consider more like a remote bcakend bc trfrm wil nt read its statefile frm here
when we run tefrm init, it wil initialize the s3 bucket as its backend 
so thats what we will call it , a remote backend for state storsge 
and we ll see hw we can secure the s3 busket using diamond or db table as part of our security
bc when ur collaborating with ur  team member,  the statefile neds to b accesible ,evry team mmeber  neds to hv acces to the state file bc ur working on the same 
infratsure 
so thsi statefile nedst to be in a place wher we can collobrate  bt we dnt push our statefile in github or repository
it needs to b in a secured env and thats why we  aer goin to b usin an s3 bucket

on monday we ll see hw we can use an s3 bucket to store our statefile an dnt jsut taht
the trfr we v been running, we v been uisng trfrm as an open source
trfrm in our local env bt we ll also see we hv whats called trfrm cloud
its more for entrprise bt u can sign up an account, u can hv an account in eneterprise cloud and 
for rnterprise cloud trfrm operations wil b happing in the trfrm cloud, u ll caete a respo and trfem is able to monitor ur repo 
or ur able to isseu trefrm commands in in ur local env bt what is happening , trfrm build evertin in terfrm cloud


but for now jst go tru ur  meta argument ,data sources ,  and be comfortable in manipulating data 
and the exrecise we did today,  atleat it shud hv solididfied ur understanding of how data sourecs works and hw the provider meta araument works
the bottem lin eis is jsut undersatnd the concept of h weverytin works 


        QUETSION 
1) The diff btw count meta n for each,i noticed that thers an index in the count bt aside frm that is der any othr diff?? Cos it seems they do d same tin, multiple resources
 ANS:
once we start doing loops which i think i can show u guys on monday, u will see the major dif f
whenu use count, it wrks on alist bc list, if u knw what is called data type, u can v a list n u can hv a map, a set , all these are data types
 so if u are using count, if its reading frm a list, what will happening is it sequences values frm a lsit whic is 0index , so frm 0, 1,2, 3,4,5
bt the problem with count i sthat if u cm an remove a valaue frm the middle of the list , which according to count as it sequence, it was suppose 2 b at index1, bt if i 
remove that value frm d middle of the lsit , what happens is that is going to shift the resource at index2 it moves it to bcome index 1, trfrm does that by destroying d 
resource that was in index2 so that it shifs it to 1 bc list cnat hv a gap inbetween (it has to run frm 0 to whatever)so thats the downside of count  bt if u remove a value
 frm the top of the list the last eelemt, it wil stil wrk fine bc ur nt modifying anytin frm 0 , d problem is if anytin is taken frm d middle 

thats why for each now becomes more superior bc for each uses a set or a map , so lng as u can convert ur list into a set , then a set is nt index, values in a set are nt
indexed like frm 0123, values ina set as a data type are refrernced by the name , so if i remove the name fmr the midlde of the list ist only gon tp affect the resource 
taht has that name bc we are using keys, we are using names, we ar nt using index

2) for each , can we create two,  t2 medium  bc the example we used, we actually t2 micro, t2 medium 

ANS:
bc as longs it reads frm the list right??

*********he tried to practicalise it bt his system was nt working, his IDE is frozen
he said just play with it by yourself and see what happens 


3) if we used a life cycle to prevent the instance not to be deledte bt if the instance was in that particular vpc , can we delete the vpc

ANS: 
NO U CAN NEVER DELETE A VPC THAT HAS A RESOUREC IN IT 
if a vpc has a resoure, it cannot be deleted, if u try to delete it it gives u an error 


4) when u were working on meta argument, i saw a place u mentioned abt the element bt u didnt emphasize more on it, bt i was wondering, how does element factor in the count
or meta argument

ANS:
 there are things i didnt mention bc those are part of trfrm functions, as u realise i ddint cover much on function, an element is a function, we can use a function called 
element to extact a value  , or lememe jst call it an element to extract an obj frm a list, that is a function that will go and pick a value frm a list
so u can use a function to get those values frm a list bt  w estill hv  atopic to talk abt tfrrm function , and tahts when we will talk abt loop n all that n thats why i 
didnt mention it



so keep practising with thos meta arguments bc 
once u have a good mastery of them then ur all good to wrk eith terfrm once u knw the backend and all that, u guys shud be gud
then when we transition to bootcamp we would now igve you more advanced ocncept 
for now this is jsudt the  foundation of trfrm
you need to undertsnd the trfrm blocks, the workflow, the backends , n jsut some basic concept for u to b able to run tfrm
but once w ego tru the bootcamp, we start puting in some advanced concept in trfrm 










































