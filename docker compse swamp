################## just me remember to study the docker commands ,, telling myself

an e-commerce java based web application for ebay 
ligin 
registreation
checkout
payment
order

 we ar passing an ecommerce ntwrk, we wnt the appl to all tlak to each other, so we v to deploy them in the same ntwrk 
the container can only talk to ecah other if they ar in the same ntwrk, using their hostname if they ar in d same ntwrk
we ar deploying in detachable mode -d 
                                                                this is the login image
 3) docker run --name login --network ecommerce -d -p 5000:8080 mylandmarktech/login    
         *********************** for the other containers, we nt using any port number 

 ############### these ar multiple commands that we ar doing  , and dis ar d dif images we ar using bc we hv decopled d appl into micro serv, so we v multiple micro services
on top of it  we v a database and the image is mtsql
 b4 deployin dis app, we nid to creat d ntwrk 
1) docker network create ecommerce ( custm bridge ntwk) and we nid the vol, we nt to mount d vol to our container, so we  ar creating  the vol
2) docker volume create datas
*************** total of 9c0mmands to creATE DIS APP, ...... THIS IS A CHALLENGING TASK

4) docker run --name  registration --netwrk  ecommerce -d mylandmarktech/registration 
5) docker run --name cart --netwrork ecommerce -d mylandmarktech/cart
6) docker run --name checkout --network ecommerce -d mylandmarktech/checkout
7) docker run --name payment  --network ecommerce -d mylandmarktech/payment 
8) docker run --name order  --network ecommerce -d mylandmarktech/order 
9) docker run --name -mysql - network ecommerce -v datas:/var/lib/mysql mysql       for mysql
 docker run --name  mongo --network ecommerce -v datas:/ data/db mongo -         then we nid to pas some env var

someone jst reminded me , we also nid to pass env var   -e

***********16:33 
17:22*********************
lets check in dockerhub and find out if we ar going to use mysql , what is going to be the env variable to be defined, remember, we v seen mongodb , dis time around
when u start working what is used in ur env is nt mongodb bt mqsl ..
in docker hub, we can see the command, hw to deploy it, the paswd, env var, wher data is stored , if i wnat to create a mount point /var/lib/mysql , so we ar pasin env var

so for us to be able to manage all of this we wil use a docker compose file and the we'll see hw wit the use of my docker compose file can create my ntwrk for me, create my
volume and create all this containers and will call all the containers services
21:29 ####### & what u nid at this time of the course shud nt b a problem bc if u google wot is docker compse the link goes to docker hub, it gives overview, hw to install
and we nid to knw our docker version, docker engine version, to knw the docker compose version to use
and if u nid  a docker compose file, we can hv smaples of  a docker compose file...
***************** and docekr compose file is a .yml file
docker-compose .yml
we'll start studying a new language called yml and its the simplest language ucan study in programing
 the firts tin to start in this file is version
generally for any programming language 

23:17  ***********languages
yml
xml    , in xml e.g if u want to get some inf abt servers , multiple servers
<servers></servers>    , this is hw code is managed in xml
inside this server, i v multiple servers
<servers>
 <servers>
<servers>nexus</servers> 
<servers>jenkins</servers> 
<servers>tomcat</servers>        now i hv a gud number of servers , so inside my servers, i v nexus, jenkins and tomact
</servers>                     this is xml, this is a list servers

lets ASSUME THAT I WNT TO ENTA SOME PARAMETERS LIKE , SERVER ID 
<servers>
 <servers>
   <id>nexus</id> 
   <login>admin</login>                   this is hw xml is written 
   <password>admin</password>
  <password>$pwd</password>             i can enter tha passwd as a variable, ie am caling the pw frm somewhere else, wich means the pw is defined somewher else bc its nt very
</servers>                                                                    secured for u to pass PW like this,  bt this is external so similarly
<servers>
  <id>jenkins</id>
  <login>jenkins</jenkins>
  <password>admin</password>
  </servers> 
<servers>tomcat</servers>      
</servers>   


*******29:27 
the simplest laguage u can think of is the yml language
generally in any programming lanugae, we v the diff kind of data u can eneter, what we call:
data types
interger     example of interger
    age: 60
string    ... usually put in single of double quote "
   name: "landmark"
dictionary  (key:value pairs)
   name:"simon"
   age : 55
   pob: "lagos"
list/array         under list we can hv diff attributes like age ...
  students:
   -name: simon
    age:
    salary:
  -name: pau
  -name: keren
maps
objects
class

34:00  ******************* we wnt to create a docker compose.yml
Before u create this file, the first tin is the diff version w ecan use , u nid to knw the version of docker to decide the version of docker compose that u nid

#######################################################################    HOW TO GET UR DOCKER VERESION TAHT IS RUNNING

docker info , will give the verssion that is running OR 
docker --version
e.g u can use dokcer compose 3.1 for any docker 1.13.1+
our docker vesiron : 20.10.7 

version : '3.1'    the nxt tin we v is ,,, bc yml wil nid spacing a lot
services:
  mongo
login
registration
check 
cart

    ************** bt in this example, we'll jsut hv our database and a single service , voumes and ntwrk
****************************************************************************************************************


version : '3.1'    the nxt tin we v is ,,, bc yml wil nid spacing a lot
services:       **************** i can create any numbe rof micro services under this version of docker compose e.g mongo and springapp
  mongodb        in deployin d database, i wnt to use the image             *************38:58                            maintain 2spacing
    image: mongo
    networks:            in deployin the appl we nid ntwrk ,, we can v multiple ntwrks
    - ecommerce
    -fintech:
    volumes:              we nid volume 
    - mongo-data:/data/db
    environment:
    -MONGO_DB_                            4*:12  we ar nt doing port publishing bt if we were to do it , we 'l v a keyword called port
    -MONGO_DB_    48:24  
springapp      
    image: mylandmarktech/spring-boot-mongo     ..  ..1:11:07    spring-boot-mongo is the name of the service
    restart: always    
    ports:
    - 6000:8080     
    networks:
    - ecommerce
    - fintech     
    environment:
    - MONGO_DB_HOSTNAME=mongodb
    - MONGO_DB_USERNAME=devdb
    - MONGO_DB_PASSWORD=devdb123                                                                        ( 53:00 .... example below)
    depends_on:   this means that springapp depend on mongodb  therfore our dabase shud be created first before i bliv ... spring appli    
    mongodb                                           ie our spring application port to be created depends on the database port mm,,..  .. 54:20
volumes:   can create multiple volumes 
   mongo-data:                                                                 maintain 2spacing
     driver: local
    ebs-data       ......... this is external data
      driver: rexray
networks:
  ecommerce:   ..........  for the netwrk i nid the driver
    driver: bridge
  fintech:                                                                                                                    41:00
     external: true      . when i say driver is bridge and external is true , that means the ntwrk already exists so i wnt to use an existing ntwrk am nt craeting the ntwrk
##############################################################################################################

NEXT:

54:22 ###### we copy this docker compose file ..we want to deploy using a 'file' a file is imp bc a file gets to do wit infrastructure as a code wich is very imp

1) i want to create a dir               1200 1 bed  ,, 1400 2bed
mkdir app26 ; cd app26
2) vi docker-compose.yml                             55:40
then paste  the above file and save

**************** dnt freak out bc this code is part of our project already, if u go to the project that we v for this stuff we already v d code ther
                  is oin our github repository, this docker compose file is already ther, most of the time it wil b part of ur source code bt u nid to understand if u nid 
               to change anytin like the image version and so on 

** now v created my docker compose file bt before i can run any docker compose command , i will be reQ to instal dodcker compose
 so first docker compose i can run to check if my file is ok 
3) docker-compose config      ....************* am told to  install docker compose 
4) sudo apt install docker-compose;
 NOW docker-compose config  TO check if the file is ok:    ..... file is ok
now we ar told that its going to create ntwork called ecommers then it wil use na existing ntwrk and it wil create dis services, then a local and ebs vol & a local vol
next 
we deploy the appliaction
5) docker-compose up -d    .... its going to create app26_ebs-data" with/using the  rexray driver" in  our aws account
                              ERROR:  it says NONEXISTENT DRIVER REXRAY 
*****************  so docker plug in ls    ... to check why w ev the error                                           i didnt go bk to d file to correct it
so its telling us thta this particular driver dis particuale driver does nt exist bc we v defined rexray instead of rexray/ebs & i can also pass the version  59:59

*************** NOW EVERYTHING HAS BEEN DEPLOYED ***********************
if i run docker-compose down   .... it wil delete everytin that we created bt fintech didnt delete bc it is external. ie was created b4 we created/deployed the file
can also run docker volume prune to delete local volumes then ill be left with just the external volumes
###################  so docker compose is very imp, its easily manageable to use in deploying ur application and commands ############
e.g if u go to our github account we still v dis file, eveytin is der as it was originally defined, if u want to change smt u jsut go and change the version

*** in rreal time we ar going to be using dodcker compose file to do our deplyment 

1:04  docker compose ps   oR docker ps
shows my containers are up 

***************** we can see the a prefix app26;springapp_1  , thats bc it inherited the dir name we created in step no. 1 ... app26

to access tha application , it shows the application  container ip address ... 1:05:00
ubuntu@dockerbuild:~/app26$ curl if config.co   ... 
3.93.218.173
curl -v localhost:6000          ,we were able to connect to the application 
**********************bt we couldnt connect online,, someone said smt and he said i think this  #file 7= does nt v any application path
someone said bc port 6000 has been used previous bt he said dats nt a problem bc if u create a container n delete it the port becomes available
bt lets find out : netstat -tlunp    ie tcp , upd port number

*********** howevre his main point is for us to see ew ecan usea docker compos efile and der ar multiple commands that we can run 
thers a scenerio were if u were trying to deploy dis application , like let me assume that , am goin to copy this file, he copied a docker file frm  his repo in github n 
vi into a file then paste the copied file

version: '3.1'
services:
springboot:     
    image: mylandmarktech/java-web-app
    restart: always    
    ports:
    - 9090:8080     
    networks:
    - mavenapp     **************** if u dnt indictae d driver ,e.g driver:bridge it is going to be created in the brige ntwrk 
     driver:bridge               so i wnat to create a ntwrk for maven app and this is the custom bridge
****  so to deploy d appl, 
docker-compose -f docker- compose_mwa.yml config... to check if d file is ok. (docker-compose -f docker- compose_mwa.ym) bc its nt d default docker file name: docker-compose
then docker-compose -f docker- compose_mwa.yml .....................................to deploy 
and docker-compose -f docker- compose_mwa.yml down ...............................  to  delete the application
******* 1:15:08  .....******************** u can deploy anytin using docker compose
he accessed the application on the CLI: curl -L localhost:9090/java-web-app

docker-compose --help  ... give sthe list of commands  ........... 1:17:40

#######################################################################################################################
EXAMPLE:

        an e-commerce java based web application for ebay 
login 
registreation
checkout
payment                          EXAMPLE: OM,                                                                             53:30
order        so we can equally say here that order depends on :login,reg,checkout,, so if ders no checkout order cannot be placed
depends on:
-login 
-registreation
-checkout
-payment
#########################################################################################################################################

docker-compose --help  ... give sthe list of commands  ........... 1:17:40
######################################################################################
###############################################################################



EVEN THough we v been able to deploy our application in docker using vol, netwrk, env var n deploying multiple containers, we v realised that it is very easy fro us 
to put all of those containers in a particular file called docker compose file bt the question is can i scale my application when i use docker? ,, w ecannot do that n
this is bc docker does nt support  multi hosting , a multi host netwrk architecture, n so we nid to see hw we can use the option that support multi hosting bc we wnt a
situation were we can hv severs in a cluster n for us to that we will look at docker swamp 
""""""""#####################################################:::' READUP POWERPOINT""""""""""\|||||#########################################

1:19:52 ... hw does swamp work 
THE TRADITIONAL MODEL;
traditional docker is running with independent servers n each of the independent docker machine v their docker cli where we run d diff docker commands Bt if u v a docker
server like this that goes down then that means ur applications are down, so ders no option to resolve such issue so what are we going to do ?
we v a swamp , a swamp is going to be a cluster
A swamp is a cluster that comprises of master node and worker node 1:20:00
so far we v been using docker as our containerization tool bt we realized that whan we craete containers, wecannot scale,  e.g w ev sooo much traffic, that traffic we
cannot scale n dats why we talk abt docker swamp
Docker swamp is simply a container oschestrator
so we v docker swap , kuberDockernetes , openshift ..all of these are ochestrators
**********************************FEATURES ............................ readup
SWAMP FEATURES
1)Cluster mgt : here we v
masternodes + worker nodes... ..  here we can v like 3 masters and 3 workers in one swamp,, so all these workers are together in one cluster n onces we put dem together,
doskser runs on all of them, what tk place is dat u can deploy ur app n it is goin to be scahedules in any of thses nodes,

1:24:01  ............*  USING A DIAGRAM  , he explained
we v a manger, ie i bliv a msater , the manger wil talk to diff nodes (worker node) and in all the nodes docker engine is running in all the nodes, so all the nodes v docker
engine, we ll mk sure taht doscke ris running in al the nodes n same in the master, we v docker running in the master
wot happens is that when we create containers, the mastr wil b able to lB BT when we ar trying to crate conatiners d masterwil server asa manager an ochestrator so he wil
b able to scheduel containers to be created in the nodes, it wil act a s amanger,  n part of the task that it does is scheduling.e.g if we nid like 50 replicas of our 
container running, it is goin to place the conatiners in d nodes that are avilabe ,, this is what a swamp does..  


2) it has a decentralixed design
3) declarative service model:( docker-compose file) when  u cretae a file(likw we did above) wher u can declare everytin u wnt to deploy , its a declaratibe approach to do
deployment bt when u
run command thats d imperative approach , so we can declare everytin we wnt to deploy in a single file
4)scaling :  e.g we can hv 100replicas of our conatiners runing
5)dESIRED state reconciliation : e.g if i v 100replicas runing n i want to change my replica state to 200, it means that my desired state is now 200, d swamp wil ensure 
that i v 200replicas running  ,, so it muts reconcile
6) multi-host netwrk : called (overlay)  ... 1:26:40
7)service discovery 1:27:26  ,,e.g we v this services  , we wnt to run the container bt what do i nid to run the contianers,, the image ,the image is the most imp tin  to
deply a container ,bc , container is the runnimg instance of the image, so for login, rg,payment,ordeer ,mongodb, we nid the image. n hw wil d containers communicate with 
each other, bc we ar talkin abt service discovery, hw wil login discover reg, hw wil reg discover payment n talk to payment, hw wil payment discover order n talk to order
hw will d database tlak to the applications ,, so network becomes imp. 
Docker-compose-myapp.yml
version:'3.1'
services:
 login:
   image:
   networks:
 registration:
    image:
    networks:
 payment:
   image:
   networks:
   order:
   image:
   networks:
 mongodb:
   image:
   networks:
dns resolution is done using service names and IP
1:31:00
 we v to ensure thay ar in the same ntwrk (if nt they wil be created in d default bridge ntwrk n they wil b able to talk using only their ip adress wich is dangerous)
so in docker swamp, our DNS resolution is done using service names  , this service name is like the application name, it is nt done using service ip . 
NOW IF login wnats to talk to registration, it wiltalk to it using the name n not the IP address.

$$$$$$$$$$ with docker ochestrators , be it docker swamp, kubernetes etc, they cm wit advanced networking that permits the containers to talk to each other even if we dnt pass 
ntwrks in d file, once ur deployn in a docker swamp, they ar goin to easily talk wit each oda via service discovery.bc d dns resolution is done using d service names e.g d 
micro service appl can talk to the database using the name n thats why in our env var we ar very careful wit dis data  ..... 1:32:51

8)load balancing: e.g we ar receiving a lot of trafic. endusers traffic are mounting , so when it mounts n users r trying to access thsi appl, e.g i wnt to create 60 replicas
of my appl, d master wil schedule d replica to be created in any of this worker node including the master, so it does lb n when trafic equally is coming xtranally,it wil be 
routed bc ininternally it is doin LB   ... 1:33;35
9) secure by default
10) rolling updates

QUESTION: what happens if a node is down???
remember in real time, w ecan v like 3 masters , we can v a forum/quarum wher we v like 3 masters n 11 replicas so if one master is down d oda master is available to support

$$$$$$$$$$ 1:34:15 Intalling docker swamp , very easy bc kubernetes is kubersome 
ubuntu@dockerbuild:~/app26$ docker node ls    ,,, i wnt to list the number of nodes
This node is not a swarm manager. use Docker swarm init or docker awarm join to connect this node to swarm and try again.
now i want to create this guy, i wnt this node ubuntu@docker to be my manger, let me jst create a new hostname for this node 
ubuntu@dockerbuild:~/app26$ sudo hostname master    ................. so now my host name is manager
ubuntu@dockerbuild:~/app26$ docker swarm init ...................i wnat to initialize this docker server to become my manger
immediately i nitialize, it gives me a token i can use to add other worker node, it also says to add a manager to this swarm, run docker swarm token join manger ....1;36:13
so i can v 3managers here running the docker swarm join manager and follow the instructions  
so if i wnat to add another server to be another master so both of them wil be performing admi task this is what i wil do ... bt i wont now ,, i wnt to do this 
ubuntu@dockerbuild:~/app26$ he pasted the token to add worker node   .. am going to xplain smt cos this takes us to security 
************************ 1:37:01  ##############we wnt to initialize docker swarm , we v a command like this initializing docker swarm 
##################


.............

################################################################################################.... STEPS
steps:    ... on only ubuntu server
MASTER:
docker swarm init

worker nodes:
#!/bin/bash
sudo hostname node1               
sudo apt update -y          
sudo apt install docker.io -y  
sudo usermod -aG docker ubuntu 

1)install docker community Edition in all the 3 servers
   And Add user (ubuntu) to docker group 
2) open below ports in Aws Security Groups
  Tcp PORT 2377 FOR CLUSTER MGT COMMUNICATIOMNS
  Tcp and UDP port 7946 for communication among nodes
 UDP port 4789 for overlay netwrk traffic

if you are planning on creating an overlay netwrok with encryption   (--opt encrypted), you will also need to ensure ip protocol 50 (ESP) traffic is allowed

3) execute below command to inintiate docker swarm manager in one system
#initialize docker swarm cluster
  docker swarm init
#Get worker token
  docker swarm join-token worker
#Get manager token to add another node as secondary manager
docker swarm join-token manager
4) Add workkers machines to cluster
# Execute join token(worker token from manager) in all worker machines
5) display docker cluster nodes in manager machine 
  # docker node ls
6) deploy sample docker application in docker swarm cluster
 docker service create --name webserver -- replicas 2 -p 80:80 httpd
############################################################################################################
the first tin to do is:
to add any worker node to the swarm we are going to
sudo apt update -y             ................      
 sudo apt install docker.io -y    .................   install docker in the node
 sudo usermod -aG docker ubuntu   .................  add ubuntu user to the docker group
sudo docker swarm join --token ....................  then add the node to the cluster
..................  thentoken .....................

ubuntu@dockerbuild:~/app26$   docker node ls
  i v jsut one node called master

1:39:29   we want to deploy a swarm server 
i will add a hostname to this commands 

#!/bin/bash
sudo hostname node1                so we wnt to add this node1 to our swarm
sudo apt update -y          
1) sudo apt install docker.io -y  
3) sudo usermod -aG docker ubuntu   
4) sudo docker swarm join --token 
..................  the token ....................................... 

we go to the aws account , to create node1
am deploying docker swarm frm ubuntu server
launch instance 
in aws he went to the choose image frm the list of images , t2 micro 
if u want to run configuration during launch , you use a user data 1:43:00
paste the user data , wich wil assign a host name , install docker in the server n its goin to add the server(node1) to my cluster
sudo hostname node1                
sudo apt update -y          
sudo apt install docker.io -y  
sudo usermod -aG docker ubuntu   
sudo docker swarm join --token 
..................  the token ....................................... 

add tag: node1
2) security:  Read up power point for ports rEQ to be open. 
they shsdu be open for easy communication within the cluster
******* he then used the security grp that already had all d reQ ports open
launch server 
he launced 2 more servers

#####################################################################################################
commands
syntax check
 docker-compose config
docker-compose  -f bossy.yml config   ......  for  files not using the default docker file name
create services/container
docker-compose up -d

Remove Services/containers
docker-compose down
###############################################################################################

1:46:50 
5) ubuntu@dockerbuild:~/app26$ docker node ls
i now v 3nodes and 1 master   ....... so we ar now in a cluster
ubuntu@dockerbuild:~/app26$   dodcker netwrk ls
we now v a new netwrk ... overlay   ,,, bc whenever we ar deploying in a swarm, our containers wil be created in the overlay netwrk.. overlay ntwrk means that u can 
communicate wit dif nodes, the master can communicate with multiple nodes using the overlay netwrk, with overlay the container in node1 can talk with the conatinters in 
all the other nodes.
1:56: 
at this time we hv installed a docker swarm cluster  and one of the tin we are benefitting of this clustering is that it comes with 
H.A ---> High Availability ... bc we v multiple docker host server, if one server goes down we knw der ar other servers that are available
F.T ---> Fault Tolerance 
Scalabilty
L.B

we wil see hw fault tolerance will be able to work within this cluster

To deploy in normal stanalone server:  .. we use the docker run command 
#in normal (stanalon) Docker server we can use below command to create a container.
docker run -d -p <hostport>:<containerPort> --name <containerName> <imageName>

##in normal (stanalon) Docker server we can use below command to create a container.
 docker-compose up-d   ... using docker-compose file

6) to deploy application in the swarm cluster:
#In Docker swarm we wil use below command to deploy service.
docker service create --name <serviceName> -p <hostport>:<containerPort> <imageName>

#In Docker swarm we wil use below command to deploy service using docker compose file
docker stack deploy --compose-file docker-compose.yml <stackName>

1:59:32   ........................... we are creating  a service, the name is called java web app
#   docker service create --name javawebapp -p 7000:8000 mylandmarktech/java-web-app
netstat nltup ...to check if port 7000 is in use
now create the service called java web app
6) docker service create --name javawebapp -p 7000:8000 mylandmarktech/java-web-app
docker service ls
docker service ps javawebapp  ..... we can see its in the master node 
########## someone said we can use :....... netstat -an | grep 7000  ... we ran it n it showed listening
now
when we create a service, we can achieve scaling, i can scale up and scale down my service

################### HOW TO SCALE UP AND SCALE DOWN########################################
now we v this service that is running on the master node, we can run:
ubuntu@dockerbuild:~/app26$ docker service scale javawebapp =3
now we v scaled to 3
i desire to v 3replicas and now i v 3 replicas that are running
i can equally scalled up to any desired number ....
ubuntu@dockerbuild:~/app26$ docker service scale javawebapp =4
now i v 4

************ so using docker swarm we are able to scale
ubuntu@dockerbuild:~/app26$ docker service ps javawebapp
we can see the all the replicas
2 running in master 
1 was scheduled in node1 
the other was scheduled in node 2
so we can be able to achieve scaling when it comes to docker 

2:09:17
 this is a normal docker run command 
docker service ps javawebapp
docker service ls
docker service ps javawebapp

we also use docker compose file to create containers

##in normal (stanalon) Docker server we can use below command to create a container.
 docker-compose up -d   ...... using the docker compose file

similarly, 
#In Docker swarm we wil use below command to deploy service using docker compose file
we re going to be deploying a stack
docker stack deploy --compose-file docker-compose.yml <stackName>

note: open REQ ports in AWS Security Groups ####################y

###################### HOW TO DEPLOY APPLICATION IN DOCKER SWARM

docker swarm has 2modes:
Replicas ---> it will deploy based on replictaed number    (we v used this mode to deploy above)
***** this is the default mode & with this mode, it wil deploy base on the number of replicas that you want     ... 2:11:24
 ********** scaling is achieveable
***** we can run docker service scale javawebapp=5
    we deploy custom applications using this mode  ..
most of the applictaion we wil be deploying, we wil be using the replica mode

using Replica mode:  in this mode u dnt nid to state taht u are using replica mode
#docker service create --name javawebapp -p 7000:8000 mylandmarktech/java-web-app


Global ---> All the nodes (3servers 1 manager+2workers)
          use for monitoring softwares deployments
          New Relic / Prometheus / Cloudwatch

with the global mode for e.g, if u v a cluster that has 14servers or 14 nodes(3master + 11 workers)
###############################################################################
what is service in docker or docker swarm?
service is nothing but a collection of one or more replicas(containers)of same type(image)
what is stack in docker or docker swarm?
stack is nothing but a collection of one or more services 
##################################################################################



 



































